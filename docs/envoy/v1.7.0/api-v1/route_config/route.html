

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Route &mdash; envoy tag-v1.7.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  
  
  

  

  
  
    

  

  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Virtual cluster" href="vcluster.html" />
    <link rel="prev" title="Virtual host" href="vhost.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> envoy
          

          
          </a>

          
            
            
              <div class="version">
                tag-v1.7.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../about_docs.html">About the documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../intro/intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../start/start.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install/install.html">Building and installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configuration/configuration.html">Configuration reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../operations/operations.html">Operations and administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../extending/extending.html">Extending Envoy for custom use cases</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../api.html">v1 API reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../listeners/listeners.html">Listeners</a></li>
<li class="toctree-l2"><a class="reference internal" href="../network_filters/network_filters.html">Network filters</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="route_config.html">HTTP Route configuration</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="vhost.html">Virtual host</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Route</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#runtime">Runtime</a></li>
<li class="toctree-l4"><a class="reference internal" href="#retry-policy">Retry policy</a></li>
<li class="toctree-l4"><a class="reference internal" href="#shadow">Shadow</a></li>
<li class="toctree-l4"><a class="reference internal" href="#headers">Headers</a></li>
<li class="toctree-l4"><a class="reference internal" href="#weighted-clusters">Weighted Clusters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#hash-policy">Hash policy</a></li>
<li class="toctree-l4"><a class="reference internal" href="#decorator">Decorator</a></li>
<li class="toctree-l4"><a class="reference internal" href="#opaque-config">Opaque Config</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cors">Cors</a></li>
<li class="toctree-l4"><a class="reference internal" href="#range-match">range_match</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="vcluster.html">Virtual cluster</a></li>
<li class="toctree-l3"><a class="reference internal" href="rate_limits.html">Rate limit configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="rds.html">Route discovery service (RDS)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../http_filters/http_filters.html">HTTP filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cluster_manager/cluster_manager.html">Cluster manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="../access_log.html">Access logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../admin.html">Administration interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rate_limit.html">Rate limit service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../runtime.html">Runtime</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tracing.html">Tracing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api-v2/api.html">v2 API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/overview.html">FAQ</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">envoy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../api.html">v1 API reference</a> &raquo;</li>
        
          <li><a href="route_config.html">HTTP Route configuration</a> &raquo;</li>
        
      <li>Route</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/api-v1/route_config/route.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="route">
<span id="config-http-conn-man-route-table-route"></span><h1>Route<a class="headerlink" href="#route" title="Permalink to this headline">¶</a></h1>
<p>A route is both a specification of how to match a request as well as in indication of what to do
next (e.g., redirect, forward, rewrite, etc.).</p>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">Envoy supports routing on HTTP method via <a class="reference internal" href="#config-http-conn-man-route-table-route-headers"><span class="std std-ref">header matching</span></a>.</p>
</div>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;prefix&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="nt">&quot;path&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="nt">&quot;regex&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="nt">&quot;cluster&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="nt">&quot;cluster_header&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="nt">&quot;weighted_clusters&quot;</span> <span class="p">:</span> <span class="s2">&quot;{...}&quot;</span><span class="p">,</span>
  <span class="nt">&quot;host_redirect&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="nt">&quot;path_redirect&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="nt">&quot;prefix_rewrite&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="nt">&quot;host_rewrite&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="nt">&quot;auto_host_rewrite&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="nt">&quot;case_sensitive&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="nt">&quot;use_websocket&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="nt">&quot;timeout_ms&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="nt">&quot;runtime&quot;</span><span class="p">:</span> <span class="s2">&quot;{...}&quot;</span><span class="p">,</span>
  <span class="nt">&quot;retry_policy&quot;</span><span class="p">:</span> <span class="s2">&quot;{...}&quot;</span><span class="p">,</span>
  <span class="nt">&quot;shadow&quot;</span><span class="p">:</span> <span class="s2">&quot;{...}&quot;</span><span class="p">,</span>
  <span class="nt">&quot;priority&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="nt">&quot;headers&quot;</span><span class="p">:</span> <span class="p">[],</span>
  <span class="nt">&quot;rate_limits&quot;</span><span class="p">:</span> <span class="p">[],</span>
  <span class="nt">&quot;include_vh_rate_limits&quot;</span> <span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="nt">&quot;hash_policy&quot;</span><span class="p">:</span> <span class="s2">&quot;{...}&quot;</span><span class="p">,</span>
  <span class="nt">&quot;request_headers_to_add&quot;</span> <span class="p">:</span> <span class="p">[],</span>
  <span class="nt">&quot;opaque_config&quot;</span><span class="p">:</span> <span class="p">[],</span>
  <span class="nt">&quot;cors&quot;</span><span class="p">:</span> <span class="s2">&quot;{...}&quot;</span><span class="p">,</span>
  <span class="nt">&quot;decorator&quot;</span> <span class="p">:</span> <span class="s2">&quot;{...}&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<dl class="docutils">
<dt>prefix</dt>
<dd><em>(sometimes required, string)</em> If specified, the route is a prefix rule meaning that the prefix
must match the beginning of the :path header. One of <em>prefix</em>, <em>path</em>, or <em>regex</em> must be specified.</dd>
<dt>path</dt>
<dd><em>(sometimes required, string)</em> If specified, the route is an exact path rule meaning that the path
must exactly match the :path header once the query string is removed. One of <em>prefix</em>, <em>path</em>, or
<em>regex</em> must be specified.</dd>
<dt>regex</dt>
<dd><p class="first"><em>(sometimes required, string)</em> If specified, the route is a regular expression rule meaning that the
regex must match the :path header once the query string is removed. The entire path (without the
query string) must match the regex. The rule will not match if only a subsequence of the :path header
matches the regex. The regex grammar is defined <a class="reference external" href="http://en.cppreference.com/w/cpp/regex/ecmascript">here</a>. One of <em>prefix</em>, <em>path</em>, or
<em>regex</em> must be specified.</p>
<p>Examples:</p>
<blockquote class="last">
<div><ul class="simple">
<li>The regex <em>/b[io]t</em> matches the path <em>/bit</em></li>
<li>The regex <em>/b[io]t</em> matches the path <em>/bot</em></li>
<li>The regex <em>/b[io]t</em> does not match the path <em>/bite</em></li>
<li>The regex <em>/b[io]t</em> does not match the path <em>/bit/bot</em></li>
</ul>
</div></blockquote>
</dd>
<dt><a class="reference internal" href="#config-http-conn-man-route-table-cors"><span class="std std-ref">cors</span></a></dt>
<dd><em>(optional, object)</em> Specifies the route’s CORS policy.</dd>
</dl>
<dl class="docutils" id="config-http-conn-man-route-table-route-cluster">
<dt>cluster</dt>
<dd><em>(sometimes required, string)</em> If the route is not a redirect (<em>host_redirect</em> and/or
<em>path_redirect</em> is not specified), one of <em>cluster</em>, <em>cluster_header</em>, or <em>weighted_clusters</em> must
be specified. When <em>cluster</em> is specified, its value indicates the upstream cluster to which the
request should be forwarded to.</dd>
</dl>
<dl class="docutils" id="config-http-conn-man-route-table-route-cluster-header">
<dt>cluster_header</dt>
<dd><p class="first"><em>(sometimes required, string)</em> If the route is not a redirect (<em>host_redirect</em> and/or
<em>path_redirect</em> is not specified), one of <em>cluster</em>, <em>cluster_header</em>, or <em>weighted_clusters</em> must
be specified. When <em>cluster_header</em> is specified, Envoy will determine the cluster to route to
by reading the value of the HTTP header named by <em>cluster_header</em> from the request headers.
If the header is not found or the referenced cluster does not exist, Envoy will return a 404
response.</p>
<div class="last admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">Internally, Envoy always uses the HTTP/2 <em>:authority</em> header to represent the HTTP/1 <em>Host</em>
header. Thus, if attempting to match on <em>Host</em>, match on <em>:authority</em> instead.</p>
</div>
</dd>
</dl>
<dl class="docutils" id="config-http-conn-man-route-table-route-config-weighted-clusters">
<dt><a class="reference internal" href="#config-http-conn-man-route-table-route-weighted-clusters"><span class="std std-ref">weighted_clusters</span></a></dt>
<dd><em>(sometimes required, object)</em> If the route is not a redirect (<em>host_redirect</em> and/or
<em>path_redirect</em> is not specified), one of <em>cluster</em>, <em>cluster_header</em>, or <em>weighted_clusters</em> must
be specified. With the <em>weighted_clusters</em> option, multiple upstream clusters can be specified for
a given route. The request is forwarded to one of the upstream clusters based on weights assigned
to each cluster. See <a class="reference internal" href="../../configuration/http_conn_man/traffic_splitting.html#config-http-conn-man-route-table-traffic-splitting-split"><span class="std std-ref">traffic splitting</span></a>
for additional documentation.</dd>
</dl>
<dl class="docutils" id="config-http-conn-man-route-table-route-host-redirect">
<dt>host_redirect</dt>
<dd><em>(sometimes required, string)</em> Indicates that the route is a redirect rule. If there is a match,
a 301 redirect response will be sent which swaps the host portion of the URL with this value.
<em>path_redirect</em> can also be specified along with this option.</dd>
</dl>
<dl class="docutils" id="config-http-conn-man-route-table-route-path-redirect">
<dt>path_redirect</dt>
<dd><em>(sometimes required, string)</em> Indicates that the route is a redirect rule. If there is a match,
a 301 redirect response will be sent which swaps the path portion of the URL with this value.
<em>host_redirect</em>  can also be specified along with this option.</dd>
</dl>
<dl class="docutils" id="config-http-conn-man-route-table-route-prefix-rewrite">
<dt>prefix_rewrite</dt>
<dd><em>(optional, string)</em> Indicates that during forwarding, the matched prefix (or path) should be
swapped with this value. When using regex path matching, the entire path (not including
the query string) will be swapped with this value. This option allows application URLs to be
rooted at a different path from those exposed at the reverse proxy layer. The router filter will
place the original path before rewrite into the <a class="reference internal" href="../../configuration/http_filters/router_filter.html#config-http-filters-router-x-envoy-original-path"><span class="std std-ref">x-envoy-original-path</span></a> header.</dd>
</dl>
<dl class="docutils" id="config-http-conn-man-route-table-route-host-rewrite">
<dt>host_rewrite</dt>
<dd><em>(optional, string)</em> Indicates that during forwarding, the host header will be swapped with this
value.</dd>
</dl>
<dl class="docutils" id="config-http-conn-man-route-table-route-auto-host-rewrite">
<dt>auto_host_rewrite</dt>
<dd><em>(optional, boolean)</em> Indicates that during forwarding, the host header will be swapped with the
hostname of the upstream host chosen by the cluster manager. This option is applicable only when
the destination cluster for a route is of type <em>strict_dns</em> or <em>logical_dns</em>. Setting this to true
with other cluster types has no effect. <em>auto_host_rewrite</em> and <em>host_rewrite</em> are mutually exclusive
options. Only one can be specified.</dd>
</dl>
<dl class="docutils" id="config-http-conn-man-route-table-route-case-sensitive">
<dt>case_sensitive</dt>
<dd><em>(optional, boolean)</em> Indicates that prefix/path matching should be case sensitive. The default
is true.</dd>
</dl>
<dl class="docutils" id="config-http-conn-man-route-table-route-use-websocket">
<dt>use_websocket</dt>
<dd><p class="first"><em>(optional, boolean)</em> Indicates that a HTTP/1.1 client connection to this particular route
should be allowed to upgrade to a WebSocket connection. The default is false.</p>
<div class="last admonition attention">
<p class="first admonition-title">Attention</p>
<p>If set to true, Envoy will expect the first request matching this route to contain WebSocket
upgrade headers. If the headers are not present, the connection will be processed as a normal
HTTP/1.1 connection. If the upgrade headers are present, Envoy will setup plain TCP proxying
between the client and the upstream server. Hence, an upstream server that rejects the WebSocket
upgrade request is also responsible for closing the associated connection. Until then, Envoy will
continue to proxy data from the client to the upstream server.</p>
<p class="last">Redirects, timeouts and retries are not supported on requests with WebSocket upgrade headers.</p>
</div>
</dd>
</dl>
<dl class="docutils" id="config-http-conn-man-route-table-route-timeout">
<dt>timeout_ms</dt>
<dd><em>(optional, integer)</em> Specifies the timeout for the route. If not specified, the default is 15s.
Note that this timeout includes all retries. See also
<a class="reference internal" href="../../configuration/http_filters/router_filter.html#config-http-filters-router-x-envoy-upstream-rq-timeout-ms"><span class="std std-ref">x-envoy-upstream-rq-timeout-ms</span></a>,
<a class="reference internal" href="../../configuration/http_filters/router_filter.html#config-http-filters-router-x-envoy-upstream-rq-per-try-timeout-ms"><span class="std std-ref">x-envoy-upstream-rq-per-try-timeout-ms</span></a>, and the
<a class="reference internal" href="../../intro/arch_overview/http_routing.html#arch-overview-http-routing-retry"><span class="std std-ref">retry overview</span></a>.</dd>
<dt><a class="reference internal" href="#config-http-conn-man-route-table-route-runtime"><span class="std std-ref">runtime</span></a></dt>
<dd><em>(optional, object)</em> Indicates that the route should additionally match on a runtime key.</dd>
<dt><a class="reference internal" href="#config-http-conn-man-route-table-route-retry"><span class="std std-ref">retry_policy</span></a></dt>
<dd><em>(optional, object)</em> Indicates that the route has a retry policy.</dd>
<dt><a class="reference internal" href="#config-http-conn-man-route-table-route-shadow"><span class="std std-ref">shadow</span></a></dt>
<dd><em>(optional, object)</em> Indicates that the route has a shadow policy.</dd>
<dt>priority</dt>
<dd><em>(optional, string)</em> Optionally specifies the <a class="reference internal" href="../../intro/arch_overview/http_routing.html#arch-overview-http-routing-priority"><span class="std std-ref">routing priority</span></a>.</dd>
<dt><a class="reference internal" href="#config-http-conn-man-route-table-route-headers"><span class="std std-ref">headers</span></a></dt>
<dd><em>(optional, array)</em> Specifies a set of headers that the route should match on. The router will
check the request’s headers against all the specified headers in the route config. A match will
happen if all the headers in the route are present in the request with the same values (or based
on presence if the <code class="docutils literal notranslate"><span class="pre">value</span></code> field is not in the config).</dd>
<dt>request_headers_to_add</dt>
<dd><p class="first"><em>(optional, array)</em> Specifies a list of HTTP headers that should be added to each
request handled by this virtual host. Headers are specified in the following form:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
  <span class="p">{</span><span class="nt">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;header1&quot;</span><span class="p">,</span> <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;value1&quot;</span><span class="p">},</span>
  <span class="p">{</span><span class="nt">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;header2&quot;</span><span class="p">,</span> <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;value2&quot;</span><span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p class="last">For more information see the documentation on <a class="reference internal" href="../../configuration/http_conn_man/headers.html#config-http-conn-man-headers-custom-request-headers"><span class="std std-ref">custom request headers</span></a>.</p>
</dd>
<dt><a class="reference internal" href="#config-http-conn-man-route-table-opaque-config"><span class="std std-ref">opaque_config</span></a></dt>
<dd><em>(optional, array)</em> Specifies a set of optional route configuration values that can be accessed by filters.</dd>
</dl>
<dl class="docutils" id="config-http-conn-man-route-table-route-rate-limits">
<dt><a class="reference internal" href="rate_limits.html#config-http-conn-man-route-table-rate-limit-config"><span class="std std-ref">rate_limits</span></a></dt>
<dd><em>(optional, array)</em> Specifies a set of rate limit configurations that could be applied to the
route.</dd>
</dl>
<dl class="docutils" id="config-http-conn-man-route-table-route-include-vh">
<dt>include_vh_rate_limits</dt>
<dd><em>(optional, boolean)</em> Specifies if the rate limit filter should include the virtual host rate
limits. By default, if the route configured rate limits, the virtual host
<a class="reference internal" href="rate_limits.html#config-http-conn-man-route-table-rate-limit-config"><span class="std std-ref">rate_limits</span></a> are not applied to the
request.</dd>
<dt><a class="reference internal" href="#config-http-conn-man-route-table-hash-policy"><span class="std std-ref">hash_policy</span></a></dt>
<dd><em>(optional, object)</em> Specifies the route’s hashing policy if the upstream cluster uses a hashing
<a class="reference internal" href="../../intro/arch_overview/load_balancing.html#arch-overview-load-balancing-types"><span class="std std-ref">load balancer</span></a>.</dd>
<dt><a class="reference internal" href="#config-http-conn-man-route-table-decorator"><span class="std std-ref">decorator</span></a></dt>
<dd><em>(optional, object)</em> Specifies the route’s decorator used to enhance information reported about
the matched request.</dd>
</dl>
<div class="section" id="runtime">
<span id="config-http-conn-man-route-table-route-runtime"></span><h2>Runtime<a class="headerlink" href="#runtime" title="Permalink to this headline">¶</a></h2>
<p>A <a class="reference internal" href="../../intro/arch_overview/runtime.html#arch-overview-runtime"><span class="std std-ref">runtime</span></a> route configuration can be used to roll out route changes
in a gradual manner without full code/config deploys. Refer to the
<a class="reference internal" href="../../configuration/http_conn_man/traffic_splitting.html#config-http-conn-man-route-table-traffic-splitting-shift"><span class="std std-ref">traffic shifting</span></a> docs
for additional documentation.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<dl class="docutils">
<dt>key</dt>
<dd><em>(required, string)</em> Specifies the runtime key name that should be consulted to determine whether
the route matches or not. See the <a class="reference internal" href="../../operations/runtime.html#operations-runtime"><span class="std std-ref">runtime documentation</span></a> for how key
names map to the underlying implementation.</dd>
</dl>
<dl class="docutils" id="config-http-conn-man-route-table-route-runtime-default">
<dt>default</dt>
<dd><em>(required, integer)</em> An integer between 0-100. Every time the route is considered for a match,
a random number between 0-99 is selected. If the number is &lt;= the value found in the <em>key</em>
(checked first) or, if the key is not present, the default value, the route is a match (assuming
everything also about the route matches).</dd>
</dl>
</div>
<div class="section" id="retry-policy">
<span id="config-http-conn-man-route-table-route-retry"></span><h2>Retry policy<a class="headerlink" href="#retry-policy" title="Permalink to this headline">¶</a></h2>
<p>HTTP retry <a class="reference internal" href="../../intro/arch_overview/http_routing.html#arch-overview-http-routing-retry"><span class="std std-ref">architecture overview</span></a>.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;retry_on&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="nt">&quot;num_retries&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="nt">&quot;per_try_timeout_ms&quot;</span> <span class="p">:</span> <span class="s2">&quot;...&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<dl class="docutils">
<dt>retry_on</dt>
<dd><em>(required, string)</em> Specifies the conditions under which retry takes place. These are the same
conditions documented for <a class="reference internal" href="../../configuration/http_filters/router_filter.html#config-http-filters-router-x-envoy-retry-on"><span class="std std-ref">x-envoy-retry-on</span></a> and
<a class="reference internal" href="../../configuration/http_filters/router_filter.html#config-http-filters-router-x-envoy-retry-grpc-on"><span class="std std-ref">x-envoy-retry-grpc-on</span></a>.</dd>
<dt>num_retries</dt>
<dd><em>(optional, integer)</em> Specifies the allowed number of retries. This parameter is optional and
defaults to 1. These are the same conditions documented for
<a class="reference internal" href="../../configuration/http_filters/router_filter.html#config-http-filters-router-x-envoy-max-retries"><span class="std std-ref">x-envoy-max-retries</span></a>.</dd>
<dt>per_try_timeout_ms</dt>
<dd><p class="first"><em>(optional, integer)</em> Specifies a non-zero timeout per retry attempt. This parameter is optional.
The same conditions documented for
<a class="reference internal" href="../../configuration/http_filters/router_filter.html#config-http-filters-router-x-envoy-upstream-rq-per-try-timeout-ms"><span class="std std-ref">x-envoy-upstream-rq-per-try-timeout-ms</span></a> apply.</p>
<p class="last"><strong>Note:</strong> If left unspecified, Envoy will use the global
<a class="reference internal" href="#config-http-conn-man-route-table-route-timeout"><span class="std std-ref">route timeout</span></a> for the request.
Consequently, when using a <a class="reference internal" href="../../configuration/http_filters/router_filter.html#config-http-filters-router-x-envoy-retry-on"><span class="std std-ref">5xx</span></a> based
retry policy, a request that times out will not be retried as the total timeout budget
would have been exhausted.</p>
</dd>
</dl>
</div>
<div class="section" id="shadow">
<span id="config-http-conn-man-route-table-route-shadow"></span><h2>Shadow<a class="headerlink" href="#shadow" title="Permalink to this headline">¶</a></h2>
<p>The router is capable of shadowing traffic from one cluster to another. The current implementation
is “fire and forget,” meaning Envoy will not wait for the shadow cluster to respond before returning
the response from the primary cluster. All normal statistics are collected for the shadow
cluster making this feature useful for testing.</p>
<p>During shadowing, the host/authority header is altered such that <em>-shadow</em> is appended. This is
useful for logging. For example, <em>cluster1</em> becomes <em>cluster1-shadow</em>.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;cluster&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="nt">&quot;runtime_key&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<dl class="docutils">
<dt>cluster</dt>
<dd><em>(required, string)</em> Specifies the cluster that requests will be shadowed to. The cluster must
exist in the <a class="reference internal" href="../../configuration/cluster_manager/cluster_manager.html#config-cluster-manager"><span class="std std-ref">cluster manager configuration</span></a>.</dd>
<dt>runtime_key</dt>
<dd><em>(optional, string)</em> If not specified, <strong>all</strong> requests to the target cluster will be shadowed.
If specified, Envoy will lookup the runtime key to get the % of requests to shadow. Valid values are
from 0 to 10000, allowing for increments of 0.01% of requests to be shadowed. If the runtime key
is specified in the configuration but not present in runtime, 0 is the default and thus 0% of
requests will be shadowed.</dd>
</dl>
</div>
<div class="section" id="headers">
<span id="config-http-conn-man-route-table-route-headers"></span><h2>Headers<a class="headerlink" href="#headers" title="Permalink to this headline">¶</a></h2>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="nt">&quot;regex&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="nt">&quot;range_match&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<dl class="docutils">
<dt>name</dt>
<dd><em>(required, string)</em> Specifies the name of the header in the request.</dd>
<dt>value</dt>
<dd><em>(optional, string)</em> Specifies the value of the header. If the value is absent a request that has
the <em>name</em> header will match, regardless of the header’s value.</dd>
<dt>regex</dt>
<dd><p class="first"><em>(optional, boolean)</em> Specifies whether the header value is a regular
expression or not. Defaults to false. The entire request header value must match the regex. The
rule will not match if only a subsequence of the request header value matches the regex. The
regex grammar used in the value field is defined
<a class="reference external" href="http://en.cppreference.com/w/cpp/regex/ecmascript">here</a>.</p>
<p>Examples:</p>
<blockquote class="last">
<div><ul class="simple">
<li>The regex <em>d{3}</em> matches the value <em>123</em></li>
<li>The regex <em>d{3}</em> does not match the value <em>1234</em></li>
<li>The regex <em>d{3}</em> does not match the value <em>123.456</em></li>
</ul>
</div></blockquote>
</dd>
<dt><a class="reference internal" href="#config-http-conn-man-route-table-range"><span class="std std-ref">range_match</span></a></dt>
<dd><em>(optional, object)</em> Specifies the range that will be used for header matching.</dd>
</dl>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">Internally, Envoy always uses the HTTP/2 <em>:authority</em> header to represent the HTTP/1 <em>Host</em>
header. Thus, if attempting to match on <em>Host</em>, match on <em>:authority</em> instead.</p>
</div>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p>To route on HTTP method, use the special HTTP/2 <em>:method</em> header. This works for both
HTTP/1 and HTTP/2 as Envoy normalizes headers. E.g.,</p>
<div class="last highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;:method&quot;</span><span class="p">,</span>
  <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;POST&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="weighted-clusters">
<span id="config-http-conn-man-route-table-route-weighted-clusters"></span><h2>Weighted Clusters<a class="headerlink" href="#weighted-clusters" title="Permalink to this headline">¶</a></h2>
<p>Compared to the <code class="docutils literal notranslate"><span class="pre">cluster</span></code> field that specifies a single upstream cluster as the target
of a request, the <code class="docutils literal notranslate"><span class="pre">weighted_clusters</span></code> option allows for specification of multiple upstream clusters
along with weights that indicate the <strong>percentage</strong> of traffic to be forwarded to each cluster.
The router selects an upstream cluster based on the weights.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;clusters&quot;</span><span class="p">:</span> <span class="p">[],</span>
  <span class="nt">&quot;runtime_key_prefix&quot;</span> <span class="p">:</span> <span class="s2">&quot;...&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<dl class="docutils">
<dt>clusters</dt>
<dd><p class="first"><em>(required, array)</em> Specifies one or more upstream clusters associated with the route.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="nt">&quot;weight&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<dl class="last docutils">
<dt>name</dt>
<dd><em>(required, string)</em> Name of the upstream cluster. The cluster must exist in the
<a class="reference internal" href="../../configuration/cluster_manager/cluster_manager.html#config-cluster-manager"><span class="std std-ref">cluster manager configuration</span></a>.</dd>
<dt>weight</dt>
<dd><em>(required, integer)</em> An integer between 0-100. When a request matches the route,
the choice of an upstream cluster is determined by its weight. The sum of
weights across all entries in the <em>clusters</em> array must add up to 100.</dd>
</dl>
</dd>
<dt>runtime_key_prefix</dt>
<dd><p class="first"><em>(optional, string)</em> Specifies the runtime key prefix that should be used to construct the runtime
keys associated with each cluster. When the <code class="docutils literal notranslate"><span class="pre">runtime_key_prefix</span></code> is specified, the router will
look for weights associated with each upstream cluster under the key
<code class="docutils literal notranslate"><span class="pre">runtime_key_prefix</span> <span class="pre">+</span> <span class="pre">&quot;.&quot;</span> <span class="pre">+</span> <span class="pre">cluster[i].name</span></code> where <code class="docutils literal notranslate"><span class="pre">cluster[i]</span></code>  denotes an entry in the
<code class="docutils literal notranslate"><span class="pre">clusters</span></code> array field. If the runtime key for the cluster does not exist, the value specified
in the configuration file will be used as the default weight.
See the <a class="reference internal" href="../../operations/runtime.html#operations-runtime"><span class="std std-ref">runtime documentation</span></a> for how key names map to the
underlying implementation.</p>
<p class="last"><strong>Note:</strong> If the sum of runtime weights exceed 100, the traffic splitting behavior
is undefined (although the request will be routed to one of the clusters).</p>
</dd>
</dl>
</div>
<div class="section" id="hash-policy">
<span id="config-http-conn-man-route-table-hash-policy"></span><h2>Hash policy<a class="headerlink" href="#hash-policy" title="Permalink to this headline">¶</a></h2>
<p>Specifies the route’s hashing policy if the upstream cluster uses a hashing <a class="reference internal" href="../../intro/arch_overview/load_balancing.html#arch-overview-load-balancing-types"><span class="std std-ref">load balancer</span></a>.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;header_name&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<dl class="docutils">
<dt>header_name</dt>
<dd><em>(required, string)</em> The name of the request header that will be used to obtain the hash key. If
the request header is not present, the load balancer will use a random number as the hash,
effectively making the load balancing policy random.</dd>
</dl>
</div>
<div class="section" id="decorator">
<span id="config-http-conn-man-route-table-decorator"></span><h2>Decorator<a class="headerlink" href="#decorator" title="Permalink to this headline">¶</a></h2>
<p>Specifies the route’s decorator.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;operation&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<dl class="docutils">
<dt>operation</dt>
<dd><em>(required, string)</em> The operation name associated with the request matched to this route. If tracing is
enabled, this information will be used as the span name reported for this request. NOTE: For ingress
(inbound) requests, or egress (outbound) responses, this value may be overridden by the
<a class="reference internal" href="../../configuration/http_filters/router_filter.html#config-http-filters-router-x-envoy-decorator-operation"><span class="std std-ref">x-envoy-decorator-operation</span></a> header.</dd>
</dl>
</div>
<div class="section" id="opaque-config">
<span id="config-http-conn-man-route-table-opaque-config"></span><h2>Opaque Config<a class="headerlink" href="#opaque-config" title="Permalink to this headline">¶</a></h2>
<p>Additional configuration can be provided to filters through the “Opaque Config” mechanism. A
list of properties are specified in the route config. The configuration is uninterpreted
by envoy and can be accessed within a user-defined filter. The configuration is a generic
string map. Nested objects are not supported.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
  <span class="p">{</span><span class="nt">&quot;...&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="cors">
<span id="config-http-conn-man-route-table-cors"></span><h2>Cors<a class="headerlink" href="#cors" title="Permalink to this headline">¶</a></h2>
<p>Settings on a route take precedence over settings on the virtual host.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;enabled&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="nt">&quot;allow_origin&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;http://foo.example&quot;</span><span class="p">],</span>
  <span class="nt">&quot;allow_methods&quot;</span><span class="p">:</span> <span class="s2">&quot;POST, GET, OPTIONS&quot;</span><span class="p">,</span>
  <span class="nt">&quot;allow_headers&quot;</span><span class="p">:</span> <span class="s2">&quot;Content-Type&quot;</span><span class="p">,</span>
  <span class="nt">&quot;allow_credentials&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="nt">&quot;expose_headers&quot;</span><span class="p">:</span> <span class="s2">&quot;X-Custom-Header&quot;</span><span class="p">,</span>
  <span class="nt">&quot;max_age&quot;</span><span class="p">:</span> <span class="s2">&quot;86400&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<dl class="docutils">
<dt>enabled</dt>
<dd><em>(optional, boolean)</em> Defaults to true. Setting <em>enabled</em> to false on a route disables CORS
for this route only. The setting has no effect on a virtual host.</dd>
<dt>allow_origin</dt>
<dd><em>(optional, array)</em> The origins that will be allowed to do CORS request.
Wildcard “*” will allow any origin.</dd>
<dt>allow_methods</dt>
<dd><em>(optional, string)</em> The content for the <em>access-control-allow-methods</em> header.
Comma separated list of HTTP methods.</dd>
<dt>allow_headers</dt>
<dd><em>(optional, string)</em> The content for the <em>access-control-allow-headers</em> header.
Comma separated list of HTTP headers.</dd>
<dt>allow_credentials</dt>
<dd><em>(optional, boolean)</em> Whether the resource allows credentials.</dd>
<dt>expose_headers</dt>
<dd><em>(optional, string)</em> The content for the <em>access-control-expose-headers</em> header.
Comma separated list of HTTP headers.</dd>
<dt>max_age</dt>
<dd><em>(optional, string)</em> The content for the <em>access-control-max-age</em> header.
Value in seconds for how long the response to the preflight request can be cached.</dd>
</dl>
</div>
<div class="section" id="range-match">
<span id="config-http-conn-man-route-table-range"></span><h2>range_match<a class="headerlink" href="#range-match" title="Permalink to this headline">¶</a></h2>
<p>Specifies the int64 start and end of the range using half-open interval semantics [start, end).
Header route matching will be performed if the header’s value lies within this range.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;start&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="nt">&quot;end&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<dl class="docutils">
<dt>start</dt>
<dd><em>(required, integer)</em> start of the range (inclusive).</dd>
<dt>end</dt>
<dd><em>(required, integer)</em> end of the range (exclusive).</dd>
</dl>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="vcluster.html" class="btn btn-neutral float-right" title="Virtual cluster" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="vhost.html" class="btn btn-neutral" title="Virtual host" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016-2018, Envoy Project Authors.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'tag-v1.7.0',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>