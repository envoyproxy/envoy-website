<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Thrift proxy &mdash; envoy tag-v1.20.7 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/envoy.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/tabs.css" type="text/css" />
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/clipboard.min.js"></script>
        <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Upstream Cluster from SNI" href="sni_cluster_filter.html" />
    <link rel="prev" title="TCP proxy" href="tcp_proxy_filter.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html">
            <img src="../../../_static/envoy-logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                tag-v1.20.7
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../about_docs.html">About the documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../intro/intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../start/start.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../configuration.html">Configuration reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../overview/overview.html">Overview</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../listeners.html">Listeners</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../stats.html">Statistics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../runtime.html">Runtime</a></li>
<li class="toctree-l3"><a class="reference internal" href="../listener_filters/listener_filters.html">Listener filters</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="network_filters.html">Network filters</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="dubbo_proxy_filter.html">Dubbo proxy</a></li>
<li class="toctree-l4"><a class="reference internal" href="client_ssl_auth_filter.html">Client TLS authentication</a></li>
<li class="toctree-l4"><a class="reference internal" href="connection_limit_filter.html">Connection Limit Filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="echo_filter.html">Echo</a></li>
<li class="toctree-l4"><a class="reference internal" href="direct_response_filter.html">Direct response</a></li>
<li class="toctree-l4"><a class="reference internal" href="ext_authz_filter.html">External Authorization</a></li>
<li class="toctree-l4"><a class="reference internal" href="kafka_broker_filter.html">Kafka Broker filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="kafka_mesh_filter.html">Kafka Mesh filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="local_rate_limit_filter.html">Local rate limit</a></li>
<li class="toctree-l4"><a class="reference internal" href="mongo_proxy_filter.html">Mongo proxy</a></li>
<li class="toctree-l4"><a class="reference internal" href="mysql_proxy_filter.html">MySQL proxy</a></li>
<li class="toctree-l4"><a class="reference internal" href="postgres_proxy_filter.html">Postgres proxy</a></li>
<li class="toctree-l4"><a class="reference internal" href="rate_limit_filter.html">Rate limit</a></li>
<li class="toctree-l4"><a class="reference internal" href="rbac_filter.html">Role Based Access Control (RBAC) Network Filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="redis_proxy_filter.html">Redis proxy</a></li>
<li class="toctree-l4"><a class="reference internal" href="rocketmq_proxy_filter.html">RocketMQ proxy</a></li>
<li class="toctree-l4"><a class="reference internal" href="tcp_proxy_filter.html">TCP proxy</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Thrift proxy</a></li>
<li class="toctree-l4"><a class="reference internal" href="sni_cluster_filter.html">Upstream Cluster from SNI</a></li>
<li class="toctree-l4"><a class="reference internal" href="sni_dynamic_forward_proxy_filter.html">SNI dynamic forward proxy</a></li>
<li class="toctree-l4"><a class="reference internal" href="wasm_filter.html">Wasm Network Filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="zookeeper_proxy_filter.html">ZooKeeper proxy</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../udp_filters/udp_filters.html">UDP listener filters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lds.html">Listener discovery service (LDS)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../http/http.html">HTTP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../upstream/upstream.html">Upstream clusters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../observability/observability.html">Observability</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../security/security.html">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../operations/operations.html">Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../other_features/other_features.html">Other features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../other_protocols/other_protocols.html">Other protocols</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../advanced/advanced.html">Advanced</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../best_practices/best_practices.html">Configuration best practices</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../operations/operations.html">Operations and administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../extending/extending.html">Extending Envoy for custom use cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../faq/overview.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../version_history/version_history.html">Version history</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">envoy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../configuration.html">Configuration reference</a> &raquo;</li>
          <li><a href="../listeners.html">Listeners</a> &raquo;</li>
          <li><a href="network_filters.html">Network filters</a> &raquo;</li>
      <li>Thrift proxy</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/configuration/listeners/network_filters/thrift_proxy_filter.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="thrift-proxy">
<span id="config-network-filters-thrift-proxy"></span><h1>Thrift proxy<a class="headerlink" href="#thrift-proxy" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p><a class="reference internal" href="../../../api-v3/extensions/filters/network/thrift_proxy/v3/thrift_proxy.proto.html#envoy-v3-api-msg-extensions-filters-network-thrift-proxy-v3-thriftproxy"><span class="std std-ref">v3 API reference</span></a></p></li>
<li><p>This filter should be configured with the name <em>envoy.filters.network.thrift_proxy</em>.</p></li>
</ul>
<div class="section" id="cluster-protocol-options">
<h2>Cluster Protocol Options<a class="headerlink" href="#cluster-protocol-options" title="Permalink to this headline">¶</a></h2>
<p>Thrift connections to upstream hosts can be configured by adding an entry to the appropriate
Cluster’s <a class="reference internal" href="../../../api-v3/config/cluster/v3/cluster.proto.html#envoy-v3-api-field-config-cluster-v3-cluster-typed-extension-protocol-options"><span class="std std-ref">extension_protocol_options</span></a>
keyed by <code class="docutils literal notranslate"><span class="pre">envoy.filters.network.thrift_proxy</span></code>. The
<a class="reference internal" href="../../../api-v3/extensions/filters/network/thrift_proxy/v3/thrift_proxy.proto.html#envoy-v3-api-msg-extensions-filters-network-thrift-proxy-v3-thriftprotocoloptions"><span class="std std-ref">ThriftProtocolOptions</span></a>
message describes the available options.</p>
</div>
<div class="section" id="downstream-requests-limit">
<h2>Downstream Requests Limit<a class="headerlink" href="#downstream-requests-limit" title="Permalink to this headline">¶</a></h2>
<p>Thrift Proxy can set the
<a class="reference internal" href="../../../api-v3/extensions/filters/network/thrift_proxy/v3/thrift_proxy.proto.html#envoy-v3-api-field-extensions-filters-network-thrift-proxy-v3-thriftproxy-max-requests-per-connection"><span class="std std-ref">maximum number of requests</span></a>
that each downstream connection can handle. When the number of requests exceeds the connection limit, Thrift Proxy will
actively disconnect from the Thrift client.</p>
</div>
<div class="section" id="thrift-request-metadata">
<h2>Thrift Request Metadata<a class="headerlink" href="#thrift-request-metadata" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="../../../api-v3/extensions/filters/network/thrift_proxy/v3/thrift_proxy.proto.html#envoy-v3-api-enum-value-extensions-filters-network-thrift-proxy-v3-transporttype-header"><span class="std std-ref">HEADER transport</span></a>
and <a class="reference internal" href="../../../api-v3/extensions/filters/network/thrift_proxy/v3/thrift_proxy.proto.html#envoy-v3-api-enum-value-extensions-filters-network-thrift-proxy-v3-protocoltype-twitter"><span class="std std-ref">TWITTER protocol</span></a>
support metadata. In particular, the
<a class="reference external" href="https://github.com/apache/thrift/blob/master/doc/specs/HeaderFormat.md">Header transport</a>
supports informational key/value pairs and the Twitter protocol transmits
<a class="reference external" href="https://github.com/twitter/finagle/blob/master/finagle-thrift/src/main/thrift/tracing.thrift">tracing and request context data</a>.</p>
<div class="section" id="header-transport-metadata">
<h3>Header Transport Metadata<a class="headerlink" href="#header-transport-metadata" title="Permalink to this headline">¶</a></h3>
<p>Header transport key/value pairs are available for routing as
<a class="reference internal" href="../../../api-v3/extensions/filters/network/thrift_proxy/v3/route.proto.html#envoy-v3-api-field-extensions-filters-network-thrift-proxy-v3-routematch-headers"><span class="std std-ref">headers</span></a>.</p>
</div>
<div class="section" id="twitter-protocol-metadata">
<h3>Twitter Protocol Metadata<a class="headerlink" href="#twitter-protocol-metadata" title="Permalink to this headline">¶</a></h3>
<p>Twitter protocol request contexts are converted into headers which are available for routing as
<a class="reference internal" href="../../../api-v3/extensions/filters/network/thrift_proxy/v3/route.proto.html#envoy-v3-api-field-extensions-filters-network-thrift-proxy-v3-routematch-headers"><span class="std std-ref">headers</span></a>.
In addition, the following fields are presented as headers:</p>
<dl class="simple">
<dt>Client Identifier</dt><dd><p>The ClientId’s <code class="docutils literal notranslate"><span class="pre">name</span></code> field (nested in the RequestHeader <code class="docutils literal notranslate"><span class="pre">client_id</span></code> field) becomes the
<code class="docutils literal notranslate"><span class="pre">:client-id</span></code> header.</p>
</dd>
<dt>Destination</dt><dd><p>The RequestHeader <code class="docutils literal notranslate"><span class="pre">dest</span></code> field becomes the <code class="docutils literal notranslate"><span class="pre">:dest</span></code> header.</p>
</dd>
<dt>Delegations</dt><dd><p>Each Delegation from the RequestHeader <code class="docutils literal notranslate"><span class="pre">delegations</span></code> field is added as a header. The header
name is the prefix <code class="docutils literal notranslate"><span class="pre">:d:</span></code> followed by the Delegation’s <code class="docutils literal notranslate"><span class="pre">src</span></code>. The value is the Delegation’s
<code class="docutils literal notranslate"><span class="pre">dst</span></code> field.</p>
</dd>
</dl>
</div>
<div class="section" id="metadata-interoperability">
<h3>Metadata Interoperability<a class="headerlink" href="#metadata-interoperability" title="Permalink to this headline">¶</a></h3>
<p>Request metadata that is available for routing (see above) is automatically converted between wire
formats when translation between downstream and upstream connections occurs. Twitter protocol
request contexts, client id, destination, and delegations are therefore presented as Header
transport key/value pairs, named as above. Similarly, Header transport key/value pairs are
presented as Twitter protocol RequestContext values, unless they match the special names described
above. For instance, a downstream Header transport request with the info key “:client-id” is
translated to an upstream Twitter protocol request with a ClientId value.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="tcp_proxy_filter.html" class="btn btn-neutral float-left" title="TCP proxy" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="sni_cluster_filter.html" class="btn btn-neutral float-right" title="Upstream Cluster from SNI" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016-2022, Envoy Project Authors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>