

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Fault Injection &mdash; envoy 1.19.0-dev-d86bd1 documentation</title>
  

  
  <link rel="stylesheet" href="../../../../../../_static/css/envoy.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../../_static/tabs.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../../_static/copybutton.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../../../../_static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../../../" src="../../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../../_static/jquery.js"></script>
        <script src="../../../../../../_static/underscore.js"></script>
        <script src="../../../../../../_static/doctools.js"></script>
        <script src="../../../../../../_static/clipboard.min.js"></script>
        <script src="../../../../../../_static/copybutton.js"></script>
    
    <script type="text/javascript" src="../../../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../../../index.html">
          

          
            
            <img src="../../../../../../_static/envoy-logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.19.0-dev-d86bd1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../about_docs.html">About the documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../intro/intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../start/start.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../configuration/configuration.html">Configuration reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../operations/operations.html">Operations and administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../extending/extending.html">Extending Envoy for custom use cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../api/api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../faq/overview.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../version_history/version_history.html">Version history</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../../index.html">envoy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Fault Injection</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../../../../_sources/api-v2/config/filter/http/fault/v2/fault.proto.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The v2 xDS API is not supported in Envoy v1.18.0 and above.</p>
</div>
<div class="section" id="fault-injection">
<span id="envoy-api-file-envoy-config-filter-http-fault-v2-fault-proto"></span><h1>Fault Injection<a class="headerlink" href="#fault-injection" title="Permalink to this headline">¶</a></h1>
<p id="extension-envoy-filters-http-fault">This extension may be referenced by the qualified name <em>envoy.filters.http.fault</em></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This extension is intended to be robust against untrusted downstream traffic. It assumes that the upstream is trusted.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>This extension extends and can be used with the following extension category:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../../../../../api-v3/extensions/filters/network/http_connection_manager/v3/http_connection_manager.proto.html#extension-category-envoy-filters-http"><span class="std std-ref">envoy.filters.http</span></a></p></li>
</ul>
</div>
<p>Fault Injection <a class="reference internal" href="../../../../../../configuration/http/http_filters/fault_filter.html#config-http-filters-fault-injection"><span class="std std-ref">configuration overview</span></a>.</p>
<div class="section" id="config-filter-http-fault-v2-faultabort">
<span id="envoy-api-msg-config-filter-http-fault-v2-faultabort"></span><h2>config.filter.http.fault.v2.FaultAbort<a class="headerlink" href="#config-filter-http-fault-v2-faultabort" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/envoyproxy/envoy/blob/d86bd1140a53a32d7d5558af5be4ed778eaae179/api/envoy/config/filter/http/fault/v2/fault.proto#L24">[config.filter.http.fault.v2.FaultAbort proto]</a></p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;http_status&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="nt">&quot;header_abort&quot;</span><span class="p">:</span> <span class="s2">&quot;{...}&quot;</span><span class="p">,</span>
  <span class="nt">&quot;percentage&quot;</span><span class="p">:</span> <span class="s2">&quot;{...}&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<dl id="envoy-api-field-config-filter-http-fault-v2-faultabort-http-status">
<dt>http_status</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto#scalar">uint32</a>) HTTP status code to use to abort the HTTP request.</p>
<p>Precisely one of <a class="reference internal" href="#envoy-api-field-config-filter-http-fault-v2-faultabort-http-status"><span class="std std-ref">http_status</span></a>, <a class="reference internal" href="#envoy-api-field-config-filter-http-fault-v2-faultabort-header-abort"><span class="std std-ref">header_abort</span></a> must be set.</p>
</dd>
</dl>
<dl id="envoy-api-field-config-filter-http-fault-v2-faultabort-header-abort">
<dt>header_abort</dt><dd><p>(<a class="reference internal" href="#envoy-api-msg-config-filter-http-fault-v2-faultabort-headerabort"><span class="std std-ref">config.filter.http.fault.v2.FaultAbort.HeaderAbort</span></a>) Fault aborts are controlled via an HTTP header (if applicable).</p>
<p>Precisely one of <a class="reference internal" href="#envoy-api-field-config-filter-http-fault-v2-faultabort-http-status"><span class="std std-ref">http_status</span></a>, <a class="reference internal" href="#envoy-api-field-config-filter-http-fault-v2-faultabort-header-abort"><span class="std std-ref">header_abort</span></a> must be set.</p>
</dd>
</dl>
<dl class="simple" id="envoy-api-field-config-filter-http-fault-v2-faultabort-percentage">
<dt>percentage</dt><dd><p>(<a class="reference internal" href="../../../../../type/percent.proto.html#envoy-api-msg-type-fractionalpercent"><span class="std std-ref">type.FractionalPercent</span></a>) The percentage of requests/operations/connections that will be aborted with the error code
provided.</p>
</dd>
</dl>
</div>
<div class="section" id="config-filter-http-fault-v2-faultabort-headerabort">
<span id="envoy-api-msg-config-filter-http-fault-v2-faultabort-headerabort"></span><h2>config.filter.http.fault.v2.FaultAbort.HeaderAbort<a class="headerlink" href="#config-filter-http-fault-v2-faultabort-headerabort" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/envoyproxy/envoy/blob/d86bd1140a53a32d7d5558af5be4ed778eaae179/api/envoy/config/filter/http/fault/v2/fault.proto#L28">[config.filter.http.fault.v2.FaultAbort.HeaderAbort proto]</a></p>
<p>Fault aborts are controlled via an HTTP header (if applicable). See the
<a class="reference internal" href="../../../../../../configuration/http/http_filters/fault_filter.html#config-http-filters-fault-injection-http-header"><span class="std std-ref">HTTP fault filter</span></a> documentation for
more information.</p>
</div>
<div class="section" id="config-filter-http-fault-v2-httpfault">
<span id="envoy-api-msg-config-filter-http-fault-v2-httpfault"></span><h2>config.filter.http.fault.v2.HTTPFault<a class="headerlink" href="#config-filter-http-fault-v2-httpfault" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/envoyproxy/envoy/blob/d86bd1140a53a32d7d5558af5be4ed778eaae179/api/envoy/config/filter/http/fault/v2/fault.proto#L49">[config.filter.http.fault.v2.HTTPFault proto]</a></p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;delay&quot;</span><span class="p">:</span> <span class="s2">&quot;{...}&quot;</span><span class="p">,</span>
  <span class="nt">&quot;abort&quot;</span><span class="p">:</span> <span class="s2">&quot;{...}&quot;</span><span class="p">,</span>
  <span class="nt">&quot;upstream_cluster&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="nt">&quot;headers&quot;</span><span class="p">:</span> <span class="p">[],</span>
  <span class="nt">&quot;downstream_nodes&quot;</span><span class="p">:</span> <span class="p">[],</span>
  <span class="nt">&quot;max_active_faults&quot;</span><span class="p">:</span> <span class="s2">&quot;{...}&quot;</span><span class="p">,</span>
  <span class="nt">&quot;response_rate_limit&quot;</span><span class="p">:</span> <span class="s2">&quot;{...}&quot;</span><span class="p">,</span>
  <span class="nt">&quot;delay_percent_runtime&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="nt">&quot;abort_percent_runtime&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="nt">&quot;delay_duration_runtime&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="nt">&quot;abort_http_status_runtime&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="nt">&quot;max_active_faults_runtime&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="nt">&quot;response_rate_limit_percent_runtime&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<dl class="simple" id="envoy-api-field-config-filter-http-fault-v2-httpfault-delay">
<dt>delay</dt><dd><p>(<a class="reference internal" href="../../../fault/v2/fault.proto.html#envoy-api-msg-config-filter-fault-v2-faultdelay"><span class="std std-ref">config.filter.fault.v2.FaultDelay</span></a>) If specified, the filter will inject delays based on the values in the
object.</p>
</dd>
</dl>
<dl class="simple" id="envoy-api-field-config-filter-http-fault-v2-httpfault-abort">
<dt>abort</dt><dd><p>(<a class="reference internal" href="#envoy-api-msg-config-filter-http-fault-v2-faultabort"><span class="std std-ref">config.filter.http.fault.v2.FaultAbort</span></a>) If specified, the filter will abort requests based on the values in
the object. At least <em>abort</em> or <em>delay</em> must be specified.</p>
</dd>
</dl>
<dl class="simple" id="envoy-api-field-config-filter-http-fault-v2-httpfault-upstream-cluster">
<dt>upstream_cluster</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto#scalar">string</a>) Specifies the name of the (destination) upstream cluster that the
filter should match on. Fault injection will be restricted to requests
bound to the specific upstream cluster.</p>
</dd>
</dl>
<dl class="simple" id="envoy-api-field-config-filter-http-fault-v2-httpfault-headers">
<dt>headers</dt><dd><p>(<strong>repeated</strong> <a class="reference internal" href="../../../../../api/v2/route/route_components.proto.html#envoy-api-msg-route-headermatcher"><span class="std std-ref">route.HeaderMatcher</span></a>) Specifies a set of headers that the filter should match on. The fault
injection filter can be applied selectively to requests that match a set of
headers specified in the fault filter config. The chances of actual fault
injection further depend on the value of the <a class="reference internal" href="#envoy-api-field-config-filter-http-fault-v2-faultabort-percentage"><span class="std std-ref">percentage</span></a> field.
The filter will check the request’s headers against all the specified
headers in the filter config. A match will happen if all the headers in the
config are present in the request with the same values (or based on
presence if the <em>value</em> field is not in the config).</p>
</dd>
</dl>
<dl class="simple" id="envoy-api-field-config-filter-http-fault-v2-httpfault-downstream-nodes">
<dt>downstream_nodes</dt><dd><p>(<strong>repeated</strong> <a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto#scalar">string</a>) Faults are injected for the specified list of downstream hosts. If this
setting is not set, faults are injected for all downstream nodes.
Downstream node name is taken from <a class="reference internal" href="../../../../../../configuration/http/http_conn_man/headers.html#config-http-conn-man-headers-downstream-service-node"><span class="std std-ref">the HTTP
x-envoy-downstream-service-node</span></a> header and compared
against downstream_nodes list.</p>
</dd>
</dl>
<dl id="envoy-api-field-config-filter-http-fault-v2-httpfault-max-active-faults">
<dt>max_active_faults</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/reference/google.protobuf#uint32value">UInt32Value</a>) The maximum number of faults that can be active at a single time via the configured fault
filter. Note that because this setting can be overridden at the route level, it’s possible
for the number of active faults to be greater than this value (if injected via a different
route). If not specified, defaults to unlimited. This setting can be overridden via
<cite>runtime &lt;config_http_filters_fault_injection_runtime&gt;</cite> and any faults that are not injected
due to overflow will be indicated via the <cite>faults_overflow
&lt;config_http_filters_fault_injection_stats&gt;</cite> stat.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Like other <a class="reference internal" href="../../../../../../intro/arch_overview/upstream/circuit_breaking.html#arch-overview-circuit-break"><span class="std std-ref">circuit breakers</span></a> in Envoy, this is a fuzzy
limit. It’s possible for the number of active faults to rise slightly above the configured
amount due to the implementation details.</p>
</div>
</dd>
</dl>
<dl id="envoy-api-field-config-filter-http-fault-v2-httpfault-response-rate-limit">
<dt>response_rate_limit</dt><dd><p>(<a class="reference internal" href="../../../fault/v2/fault.proto.html#envoy-api-msg-config-filter-fault-v2-faultratelimit"><span class="std std-ref">config.filter.fault.v2.FaultRateLimit</span></a>) The response rate limit to be applied to the response body of the stream. When configured,
the percentage can be overridden by the <a class="reference internal" href="../../../../../../configuration/http/http_filters/fault_filter.html#config-http-filters-fault-injection-runtime"><span class="std std-ref">fault.http.rate_limit.response_percent</span></a> runtime key.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>This is a per-stream limit versus a connection level limit. This means that concurrent streams
will each get an independent limit.</p>
</div>
</dd>
</dl>
<dl class="simple" id="envoy-api-field-config-filter-http-fault-v2-httpfault-delay-percent-runtime">
<dt>delay_percent_runtime</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto#scalar">string</a>) The runtime key to override the <a class="reference internal" href="../../../../../../configuration/http/http_filters/fault_filter.html#config-http-filters-fault-injection-runtime"><span class="std std-ref">default</span></a>
runtime. The default is: fault.http.delay.fixed_delay_percent</p>
</dd>
</dl>
<dl class="simple" id="envoy-api-field-config-filter-http-fault-v2-httpfault-abort-percent-runtime">
<dt>abort_percent_runtime</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto#scalar">string</a>) The runtime key to override the <a class="reference internal" href="../../../../../../configuration/http/http_filters/fault_filter.html#config-http-filters-fault-injection-runtime"><span class="std std-ref">default</span></a>
runtime. The default is: fault.http.abort.abort_percent</p>
</dd>
</dl>
<dl class="simple" id="envoy-api-field-config-filter-http-fault-v2-httpfault-delay-duration-runtime">
<dt>delay_duration_runtime</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto#scalar">string</a>) The runtime key to override the <a class="reference internal" href="../../../../../../configuration/http/http_filters/fault_filter.html#config-http-filters-fault-injection-runtime"><span class="std std-ref">default</span></a>
runtime. The default is: fault.http.delay.fixed_duration_ms</p>
</dd>
</dl>
<dl class="simple" id="envoy-api-field-config-filter-http-fault-v2-httpfault-abort-http-status-runtime">
<dt>abort_http_status_runtime</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto#scalar">string</a>) The runtime key to override the <a class="reference internal" href="../../../../../../configuration/http/http_filters/fault_filter.html#config-http-filters-fault-injection-runtime"><span class="std std-ref">default</span></a>
runtime. The default is: fault.http.abort.http_status</p>
</dd>
</dl>
<dl class="simple" id="envoy-api-field-config-filter-http-fault-v2-httpfault-max-active-faults-runtime">
<dt>max_active_faults_runtime</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto#scalar">string</a>) The runtime key to override the <a class="reference internal" href="../../../../../../configuration/http/http_filters/fault_filter.html#config-http-filters-fault-injection-runtime"><span class="std std-ref">default</span></a>
runtime. The default is: fault.http.max_active_faults</p>
</dd>
</dl>
<dl class="simple" id="envoy-api-field-config-filter-http-fault-v2-httpfault-response-rate-limit-percent-runtime">
<dt>response_rate_limit_percent_runtime</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto#scalar">string</a>) The runtime key to override the <a class="reference internal" href="../../../../../../configuration/http/http_filters/fault_filter.html#config-http-filters-fault-injection-runtime"><span class="std std-ref">default</span></a>
runtime. The default is: fault.http.rate_limit.response_percent</p>
</dd>
</dl>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2016-2021, Envoy Project Authors.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>