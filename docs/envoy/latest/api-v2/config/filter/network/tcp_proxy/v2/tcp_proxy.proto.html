

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>TCP Proxy &mdash; envoy 1.15.0-dev-ceb74c documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../../../../../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../../../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../../../" src="../../../../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../../../../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../../../_static/css/envoy.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../search.html" />
    <link rel="next" title="Local rate limit" href="../../local_rate_limit/v2alpha/local_rate_limit.proto.html" />
    <link rel="prev" title="SNI Cluster Filter" href="../../sni_cluster/v2/sni_cluster.proto.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../../../index.html">
          

          
            
            <img src="../../../../../../_static/envoy-logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.15.0-dev-ceb74c
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../../../about_docs.html">About the documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../intro/intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../start/start.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../install/install.html">Building and installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../version_history/version_history.html">Version history</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../configuration/configuration.html">Configuration reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../operations/operations.html">Operations and administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../extending/extending.html">Extending Envoy for custom use cases</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../../../../api/api.html">API</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../../../../api/api_supported_versions.html">Supported API versions</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../../../../api.html">v2 API reference</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../../../../bootstrap/bootstrap.html">Bootstrap</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../listeners/listeners.html">Listeners</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../clusters/clusters.html">Clusters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../http_routes/http_routes.html">HTTP route management</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../../../../config.html">Extensions</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="../../../filter.html">Filters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../accesslog/accesslog.html">Access loggers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../rbac/rbac.html">RBAC</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../health_checker/health_checker.html">Health checkers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../transport_socket/transport_socket.html">Transport sockets</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../resource_monitor/resource_monitor.html">Resource monitors</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../common/common.html">Common</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../cluster/cluster.html">Cluster</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../listener/listener.html">Listener</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../grpc_credential/grpc_credential.html">Grpc Credentials</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../retry/retry.html">Retry Predicates</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../trace/trace.html">HTTP Tracers</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../admin/admin.html">Admin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../data/data.html">Envoy data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../service/service.html">Services</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../common_messages/common_messages.html">Common messages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../types/types.html">Types</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../api-v3/api.html">v3 API reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../api-docs/xds_protocol.html">xDS REST and gRPC protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../api/client_features.html">Well Known Client Features</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../faq/overview.html">FAQ</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../../index.html">envoy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../../../../api/api.html">API</a> &raquo;</li>
        
          <li><a href="../../../../../api.html">v2 API reference</a> &raquo;</li>
        
          <li><a href="../../../../config.html">Extensions</a> &raquo;</li>
        
          <li><a href="../../../filter.html">Filters</a> &raquo;</li>
        
          <li><a href="../../network.html">Network filters</a> &raquo;</li>
        
      <li>TCP Proxy</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../../../../_sources/api-v2/config/filter/network/tcp_proxy/v2/tcp_proxy.proto.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="tcp-proxy">
<span id="envoy-api-file-envoy-config-filter-network-tcp-proxy-v2-tcp-proxy-proto"></span><h1>TCP Proxy<a class="headerlink" href="#tcp-proxy" title="Permalink to this headline">¶</a></h1>
<p id="extension-envoy-filters-network-tcp-proxy">This extension may be referenced by the qualified name <em>envoy.filters.network.tcp_proxy</em></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This extension is intended to be robust against untrusted downstream traffic. It assumes that the upstream is trusted.</p>
</div>
<p>TCP Proxy <a class="reference internal" href="../../../../../../configuration/listeners/network_filters/tcp_proxy_filter.html#config-network-filters-tcp-proxy"><span class="std std-ref">configuration overview</span></a>.</p>
<div class="section" id="config-filter-network-tcp-proxy-v2-tcpproxy">
<span id="envoy-api-msg-config-filter-network-tcp-proxy-v2-tcpproxy"></span><h2>config.filter.network.tcp_proxy.v2.TcpProxy<a class="headerlink" href="#config-filter-network-tcp-proxy-v2-tcpproxy" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/envoyproxy/envoy/blob/ceb74cdb205ca5272c4d33d39ecc9bd57f86aaf2/api/envoy/config/filter/network/tcp_proxy/v2/tcp_proxy.proto#L28">[config.filter.network.tcp_proxy.v2.TcpProxy proto]</a></p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;stat_prefix&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="nt">&quot;cluster&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="nt">&quot;weighted_clusters&quot;</span><span class="p">:</span> <span class="s2">&quot;{...}&quot;</span><span class="p">,</span>
  <span class="nt">&quot;metadata_match&quot;</span><span class="p">:</span> <span class="s2">&quot;{...}&quot;</span><span class="p">,</span>
  <span class="nt">&quot;idle_timeout&quot;</span><span class="p">:</span> <span class="s2">&quot;{...}&quot;</span><span class="p">,</span>
  <span class="nt">&quot;access_log&quot;</span><span class="p">:</span> <span class="p">[],</span>
  <span class="nt">&quot;max_connect_attempts&quot;</span><span class="p">:</span> <span class="s2">&quot;{...}&quot;</span><span class="p">,</span>
  <span class="nt">&quot;hash_policy&quot;</span><span class="p">:</span> <span class="p">[]</span>
<span class="p">}</span>
</pre></div>
</div>
<dl class="simple" id="envoy-api-field-config-filter-network-tcp-proxy-v2-tcpproxy-stat-prefix">
<dt>stat_prefix</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto#scalar">string</a>, <em>REQUIRED</em>) The prefix to use when emitting <a class="reference internal" href="../../../../../../configuration/listeners/network_filters/tcp_proxy_filter.html#config-network-filters-tcp-proxy-stats"><span class="std std-ref">statistics</span></a>.</p>
</dd>
</dl>
<dl id="envoy-api-field-config-filter-network-tcp-proxy-v2-tcpproxy-cluster">
<dt>cluster</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto#scalar">string</a>) The upstream cluster to connect to.</p>
<p>Precisely one of <a class="reference internal" href="#envoy-api-field-config-filter-network-tcp-proxy-v2-tcpproxy-cluster"><span class="std std-ref">cluster</span></a>, <a class="reference internal" href="#envoy-api-field-config-filter-network-tcp-proxy-v2-tcpproxy-weighted-clusters"><span class="std std-ref">weighted_clusters</span></a> must be set.</p>
</dd>
</dl>
<dl id="envoy-api-field-config-filter-network-tcp-proxy-v2-tcpproxy-weighted-clusters">
<dt>weighted_clusters</dt><dd><p>(<a class="reference internal" href="#envoy-api-msg-config-filter-network-tcp-proxy-v2-tcpproxy-weightedcluster"><span class="std std-ref">config.filter.network.tcp_proxy.v2.TcpProxy.WeightedCluster</span></a>) Multiple upstream clusters can be specified for a given route. The
request is routed to one of the upstream clusters based on weights
assigned to each cluster.</p>
<p>Precisely one of <a class="reference internal" href="#envoy-api-field-config-filter-network-tcp-proxy-v2-tcpproxy-cluster"><span class="std std-ref">cluster</span></a>, <a class="reference internal" href="#envoy-api-field-config-filter-network-tcp-proxy-v2-tcpproxy-weighted-clusters"><span class="std std-ref">weighted_clusters</span></a> must be set.</p>
</dd>
</dl>
<dl class="simple" id="envoy-api-field-config-filter-network-tcp-proxy-v2-tcpproxy-metadata-match">
<dt>metadata_match</dt><dd><p>(<a class="reference internal" href="../../../../../api/v2/core/base.proto.html#envoy-api-msg-core-metadata"><span class="std std-ref">core.Metadata</span></a>) Optional endpoint metadata match criteria. Only endpoints in the upstream
cluster with metadata matching that set in metadata_match will be
considered. The filter name should be specified as <em>envoy.lb</em>.</p>
</dd>
</dl>
<dl id="envoy-api-field-config-filter-network-tcp-proxy-v2-tcpproxy-idle-timeout">
<dt>idle_timeout</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/reference/google.protobuf#duration">Duration</a>) The idle timeout for connections managed by the TCP proxy filter. The idle timeout
is defined as the period in which there are no bytes sent or received on either
the upstream or downstream connection. If not set, the default idle timeout is 1 hour. If set
to 0s, the timeout will be disabled.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Disabling this timeout has a highly likelihood of yielding connection leaks due to lost TCP
FIN packets, etc.</p>
</div>
</dd>
</dl>
<dl class="simple" id="envoy-api-field-config-filter-network-tcp-proxy-v2-tcpproxy-access-log">
<dt>access_log</dt><dd><p>(<a class="reference internal" href="../../../accesslog/v2/accesslog.proto.html#envoy-api-msg-config-filter-accesslog-v2-accesslog"><span class="std std-ref">config.filter.accesslog.v2.AccessLog</span></a>) Configuration for <a class="reference internal" href="../../../../../../intro/arch_overview/observability/access_logging.html#arch-overview-access-logs"><span class="std std-ref">access logs</span></a>
emitted by the this tcp_proxy.</p>
</dd>
</dl>
<dl class="simple" id="envoy-api-field-config-filter-network-tcp-proxy-v2-tcpproxy-max-connect-attempts">
<dt>max_connect_attempts</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/reference/google.protobuf#uint32value">UInt32Value</a>) The maximum number of unsuccessful connection attempts that will be made before
giving up. If the parameter is not specified, 1 connection attempt will be made.</p>
</dd>
</dl>
<dl class="simple" id="envoy-api-field-config-filter-network-tcp-proxy-v2-tcpproxy-hash-policy">
<dt>hash_policy</dt><dd><p>(<a class="reference internal" href="../../../../../type/hash_policy.proto.html#envoy-api-msg-type-hashpolicy"><span class="std std-ref">type.HashPolicy</span></a>) Optional configuration for TCP proxy hash policy. If hash_policy is not set, the hash-based
load balancing algorithms will select a host randomly. Currently the number of hash policies is
limited to 1.</p>
</dd>
</dl>
</div>
<div class="section" id="config-filter-network-tcp-proxy-v2-tcpproxy-weightedcluster">
<span id="envoy-api-msg-config-filter-network-tcp-proxy-v2-tcpproxy-weightedcluster"></span><h2>config.filter.network.tcp_proxy.v2.TcpProxy.WeightedCluster<a class="headerlink" href="#config-filter-network-tcp-proxy-v2-tcpproxy-weightedcluster" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/envoyproxy/envoy/blob/ceb74cdb205ca5272c4d33d39ecc9bd57f86aaf2/api/envoy/config/filter/network/tcp_proxy/v2/tcp_proxy.proto#L89">[config.filter.network.tcp_proxy.v2.TcpProxy.WeightedCluster proto]</a></p>
<p>Allows for specification of multiple upstream clusters along with weights
that indicate the percentage of traffic to be forwarded to each cluster.
The router selects an upstream cluster based on these weights.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;clusters&quot;</span><span class="p">:</span> <span class="p">[]</span>
<span class="p">}</span>
</pre></div>
</div>
<dl class="simple" id="envoy-api-field-config-filter-network-tcp-proxy-v2-tcpproxy-weightedcluster-clusters">
<dt>clusters</dt><dd><p>(<a class="reference internal" href="#envoy-api-msg-config-filter-network-tcp-proxy-v2-tcpproxy-weightedcluster-clusterweight"><span class="std std-ref">config.filter.network.tcp_proxy.v2.TcpProxy.WeightedCluster.ClusterWeight</span></a>, <em>REQUIRED</em>) Specifies one or more upstream clusters associated with the route.</p>
</dd>
</dl>
</div>
<div class="section" id="config-filter-network-tcp-proxy-v2-tcpproxy-weightedcluster-clusterweight">
<span id="envoy-api-msg-config-filter-network-tcp-proxy-v2-tcpproxy-weightedcluster-clusterweight"></span><h2>config.filter.network.tcp_proxy.v2.TcpProxy.WeightedCluster.ClusterWeight<a class="headerlink" href="#config-filter-network-tcp-proxy-v2-tcpproxy-weightedcluster-clusterweight" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/envoyproxy/envoy/blob/ceb74cdb205ca5272c4d33d39ecc9bd57f86aaf2/api/envoy/config/filter/network/tcp_proxy/v2/tcp_proxy.proto#L90">[config.filter.network.tcp_proxy.v2.TcpProxy.WeightedCluster.ClusterWeight proto]</a></p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="nt">&quot;weight&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="nt">&quot;metadata_match&quot;</span><span class="p">:</span> <span class="s2">&quot;{...}&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<dl class="simple" id="envoy-api-field-config-filter-network-tcp-proxy-v2-tcpproxy-weightedcluster-clusterweight-name">
<dt>name</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto#scalar">string</a>, <em>REQUIRED</em>) Name of the upstream cluster.</p>
</dd>
</dl>
<dl class="simple" id="envoy-api-field-config-filter-network-tcp-proxy-v2-tcpproxy-weightedcluster-clusterweight-weight">
<dt>weight</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto#scalar">uint32</a>) When a request matches the route, the choice of an upstream cluster is
determined by its weight. The sum of weights across all entries in the
clusters array determines the total weight.</p>
</dd>
</dl>
<dl class="simple" id="envoy-api-field-config-filter-network-tcp-proxy-v2-tcpproxy-weightedcluster-clusterweight-metadata-match">
<dt>metadata_match</dt><dd><p>(<a class="reference internal" href="../../../../../api/v2/core/base.proto.html#envoy-api-msg-core-metadata"><span class="std std-ref">core.Metadata</span></a>) Optional endpoint metadata match criteria used by the subset load balancer. Only endpoints
in the upstream cluster with metadata matching what is set in this field will be considered
for load balancing. Note that this will be merged with what’s provided in
<a class="reference internal" href="#envoy-api-field-config-filter-network-tcp-proxy-v2-tcpproxy-metadata-match"><span class="std std-ref">TcpProxy.metadata_match</span></a>, with values
here taking precedence. The filter name should be specified as <em>envoy.lb</em>.</p>
</dd>
</dl>
</div>
<div class="section" id="config-filter-network-tcp-proxy-v2-tcpproxy-tunnelingconfig">
<span id="envoy-api-msg-config-filter-network-tcp-proxy-v2-tcpproxy-tunnelingconfig"></span><h2>config.filter.network.tcp_proxy.v2.TcpProxy.TunnelingConfig<a class="headerlink" href="#config-filter-network-tcp-proxy-v2-tcpproxy-tunnelingconfig" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/envoyproxy/envoy/blob/ceb74cdb205ca5272c4d33d39ecc9bd57f86aaf2/api/envoy/config/filter/network/tcp_proxy/v2/tcp_proxy.proto#L115">[config.filter.network.tcp_proxy.v2.TcpProxy.TunnelingConfig proto]</a></p>
<p>Configuration for tunneling TCP over other transports or application layers.
Currently, only HTTP/2 is supported. When other options exist, HTTP/2 will
remain the default.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;hostname&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<dl class="simple" id="envoy-api-field-config-filter-network-tcp-proxy-v2-tcpproxy-tunnelingconfig-hostname">
<dt>hostname</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto#scalar">string</a>, <em>REQUIRED</em>) The hostname to send in the synthesized CONNECT headers to the upstream proxy.</p>
</dd>
</dl>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../local_rate_limit/v2alpha/local_rate_limit.proto.html" class="btn btn-neutral float-right" title="Local rate limit" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../../sni_cluster/v2/sni_cluster.proto.html" class="btn btn-neutral float-left" title="SNI Cluster Filter" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016-2020, Envoy Project Authors

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>