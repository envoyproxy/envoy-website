

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Lua &mdash; envoy 1.15.0-dev-ea6903 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/envoy.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="On-demand VHDS Updates" href="on_demand_updates_filter.html" />
    <link rel="prev" title="JWT Authentication" href="jwt_authn_filter.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html">
          

          
            
            <img src="../../../_static/envoy-logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.15.0-dev-ea6903
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../about_docs.html">About the documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../intro/intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../start/start.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install/install.html">Building and installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../version_history/version_history.html">Version history</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../configuration.html">Configuration reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../overview/overview.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../listeners/listeners.html">Listeners</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../http.html">HTTP</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../http_conn_man/http_conn_man.html">HTTP connection manager</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="http_filters.html">HTTP filters</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="adaptive_concurrency_filter.html">Adaptive Concurrency</a></li>
<li class="toctree-l4"><a class="reference internal" href="aws_lambda_filter.html">AWS Lambda</a></li>
<li class="toctree-l4"><a class="reference internal" href="aws_request_signing_filter.html">AWS Request Signing</a></li>
<li class="toctree-l4"><a class="reference internal" href="buffer_filter.html">Buffer</a></li>
<li class="toctree-l4"><a class="reference internal" href="compressor_filter.html">Compressor</a></li>
<li class="toctree-l4"><a class="reference internal" href="cors_filter.html">CORS</a></li>
<li class="toctree-l4"><a class="reference internal" href="csrf_filter.html">CSRF</a></li>
<li class="toctree-l4"><a class="reference internal" href="decompressor_filter.html">Decompressor</a></li>
<li class="toctree-l4"><a class="reference internal" href="dynamic_forward_proxy_filter.html">Dynamic forward proxy</a></li>
<li class="toctree-l4"><a class="reference internal" href="dynamodb_filter.html">DynamoDB</a></li>
<li class="toctree-l4"><a class="reference internal" href="ext_authz_filter.html">External Authorization</a></li>
<li class="toctree-l4"><a class="reference internal" href="fault_filter.html">Fault Injection</a></li>
<li class="toctree-l4"><a class="reference internal" href="grpc_http1_bridge_filter.html">gRPC HTTP/1.1 bridge</a></li>
<li class="toctree-l4"><a class="reference internal" href="grpc_http1_reverse_bridge_filter.html">gRPC HTTP/1.1 reverse bridge</a></li>
<li class="toctree-l4"><a class="reference internal" href="grpc_json_transcoder_filter.html">gRPC-JSON transcoder</a></li>
<li class="toctree-l4"><a class="reference internal" href="grpc_stats_filter.html">gRPC Statistics</a></li>
<li class="toctree-l4"><a class="reference internal" href="grpc_web_filter.html">gRPC-Web</a></li>
<li class="toctree-l4"><a class="reference internal" href="gzip_filter.html">Gzip</a></li>
<li class="toctree-l4"><a class="reference internal" href="health_check_filter.html">Health check</a></li>
<li class="toctree-l4"><a class="reference internal" href="header_to_metadata_filter.html">Envoy Header-To-Metadata Filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="ip_tagging_filter.html">IP Tagging</a></li>
<li class="toctree-l4"><a class="reference internal" href="jwt_authn_filter.html">JWT Authentication</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="on_demand_updates_filter.html">On-demand VHDS Updates</a></li>
<li class="toctree-l4"><a class="reference internal" href="original_src_filter.html">Original Source</a></li>
<li class="toctree-l4"><a class="reference internal" href="rate_limit_filter.html">Rate limit</a></li>
<li class="toctree-l4"><a class="reference internal" href="rbac_filter.html">Role Based Access Control (RBAC) Filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="router_filter.html">Router</a></li>
<li class="toctree-l4"><a class="reference internal" href="squash_filter.html">Squash</a></li>
<li class="toctree-l4"><a class="reference internal" href="tap_filter.html">Tap</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api-v3/extensions/filters/http/cache/v3alpha/cache.proto.html">HTTP Cache Filter</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../upstream/upstream.html">Upstream clusters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../observability/observability.html">Observability</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../security/security.html">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../operations/operations.html">Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../other_features/other_features.html">Other features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../other_protocols/other_protocols.html">Other protocols</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../advanced/advanced.html">Advanced</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../best_practices/best_practices.html">Configuration best practices</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../operations/operations.html">Operations and administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../extending/extending.html">Extending Envoy for custom use cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../faq/overview.html">FAQ</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">envoy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../configuration.html">Configuration reference</a> &raquo;</li>
        
          <li><a href="../http.html">HTTP</a> &raquo;</li>
        
          <li><a href="http_filters.html">HTTP filters</a> &raquo;</li>
        
      <li>Lua</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/configuration/http/http_filters/lua_filter.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="lua">
<span id="config-http-filters-lua"></span><h1>Lua<a class="headerlink" href="#lua" title="Permalink to this headline">¶</a></h1>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>By default Envoy is built without exporting symbols that you may need when interacting with Lua
modules installed as shared objects. Envoy may need to be built with support for exported symbols.
Please see the <a class="reference external" href="https://github.com/envoyproxy/envoy/blob/ea6903cef0206ec73ccb329efa6209eb21466569/bazel/README.md">Bazel docs</a> for more information.</p>
</div>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>The HTTP Lua filter allows <a class="reference external" href="https://www.lua.org/">Lua</a> scripts to be run during both the request
and response flows. <a class="reference external" href="https://luajit.org/">LuaJIT</a> is used as the runtime. Because of this, the
supported Lua version is mostly 5.1 with some 5.2 features. See the <a class="reference external" href="https://luajit.org/extensions.html">LuaJIT documentation</a> for more details.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://github.com/moonjit/moonjit/">moonjit</a> is a continuation of LuaJIT development, which
supports more 5.2 features and additional architectures. Envoy can be built with moonjit support
by using the following bazel option: <code class="docutils literal notranslate"><span class="pre">--//source/extensions/filters/common/lua:moonjit=1</span></code>.</p>
</div>
<p>The filter only supports loading Lua code in-line in the configuration. If local filesystem code
is desired, a trivial in-line script can be used to load the rest of the code from the local
environment.</p>
<p>The design of the filter and Lua support at a high level is as follows:</p>
<ul class="simple">
<li><p>All Lua environments are <a class="reference internal" href="../../../intro/arch_overview/intro/threading_model.html#arch-overview-threading"><span class="std std-ref">per worker thread</span></a>. This means that
there is no truly global data. Any globals create and populated at load time will be visible
from each worker thread in isolation. True global support may be added via an API in the future.</p></li>
<li><p>All scripts are run as coroutines. This means that they are written in a synchronous style even
though they may perform complex asynchronous tasks. This makes the scripts substantially easier
to write. All network/async processing is performed by Envoy via a set of APIs. Envoy will
suspend execution of the script as appropriate and resume it when async tasks are complete.</p></li>
<li><p><strong>Do not perform blocking operations from scripts.</strong> It is critical for performance that
Envoy APIs are used for all IO.</p></li>
</ul>
</div>
<div class="section" id="currently-supported-high-level-features">
<h2>Currently supported high level features<a class="headerlink" href="#currently-supported-high-level-features" title="Permalink to this headline">¶</a></h2>
<p><strong>NOTE:</strong> It is expected that this list will expand over time as the filter is used in production.
The API surface has been kept small on purpose. The goal is to make scripts extremely simple and
safe to write. Very complex or high performance use cases are assumed to use the native C++ filter
API.</p>
<ul class="simple">
<li><p>Inspection of headers, body, and trailers while streaming in either the request flow, response
flow, or both.</p></li>
<li><p>Modification of headers and trailers.</p></li>
<li><p>Blocking and buffering the full request/response body for inspection.</p></li>
<li><p>Performing an outbound async HTTP call to an upstream host. Such a call can be performed while
buffering body data so that when the call completes upstream headers can be modified.</p></li>
<li><p>Performing a direct response and skipping further filter iteration. For example, a script
could make an upstream HTTP call for authentication, and then directly respond with a 403
response code.</p></li>
</ul>
</div>
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="../../../api-v3/extensions/filters/http/lua/v3/lua.proto.html#envoy-v3-api-msg-extensions-filters-http-lua-v3-lua"><span class="std std-ref">v3 API reference</span></a></p></li>
<li><p>This filter should be configured with the name <em>envoy.filters.http.lua</em>.</p></li>
</ul>
</div>
<div class="section" id="script-examples">
<h2>Script examples<a class="headerlink" href="#script-examples" title="Permalink to this headline">¶</a></h2>
<p>This section provides some concrete examples of Lua scripts as a more gentle introduction and quick
start. Please refer to the <a class="reference internal" href="#config-http-filters-lua-stream-handle-api"><span class="std std-ref">stream handle API</span></a> for
more details on the supported API.</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Called on the request path.</span>
<span class="kr">function</span> <span class="nf">envoy_on_request</span><span class="p">(</span><span class="n">request_handle</span><span class="p">)</span>
  <span class="c1">-- Wait for the entire request body and add a request header with the body size.</span>
  <span class="n">request_handle</span><span class="p">:</span><span class="n">headers</span><span class="p">():</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;request_body_size&quot;</span><span class="p">,</span> <span class="n">request_handle</span><span class="p">:</span><span class="n">body</span><span class="p">():</span><span class="n">length</span><span class="p">())</span>
<span class="kr">end</span>

<span class="c1">-- Called on the response path.</span>
<span class="kr">function</span> <span class="nf">envoy_on_response</span><span class="p">(</span><span class="n">response_handle</span><span class="p">)</span>
  <span class="c1">-- Wait for the entire response body and a response header with the body size.</span>
  <span class="n">response_handle</span><span class="p">:</span><span class="n">headers</span><span class="p">():</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;response_body_size&quot;</span><span class="p">,</span> <span class="n">response_handle</span><span class="p">:</span><span class="n">body</span><span class="p">():</span><span class="n">length</span><span class="p">())</span>
  <span class="c1">-- Remove a response header named &#39;foo&#39;</span>
  <span class="n">response_handle</span><span class="p">:</span><span class="n">headers</span><span class="p">():</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">)</span>
<span class="kr">end</span>
</pre></div>
</div>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kr">function</span> <span class="nf">envoy_on_request</span><span class="p">(</span><span class="n">request_handle</span><span class="p">)</span>
  <span class="c1">-- Make an HTTP call to an upstream host with the following headers, body, and timeout.</span>
  <span class="kd">local</span> <span class="n">headers</span><span class="p">,</span> <span class="n">body</span> <span class="o">=</span> <span class="n">request_handle</span><span class="p">:</span><span class="n">httpCall</span><span class="p">(</span>
  <span class="s2">&quot;lua_cluster&quot;</span><span class="p">,</span>
  <span class="p">{</span>
    <span class="p">[</span><span class="s2">&quot;:method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="s2">&quot;:path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="s2">&quot;:authority&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;lua_cluster&quot;</span>
  <span class="p">},</span>
  <span class="s2">&quot;hello world&quot;</span><span class="p">,</span>
  <span class="mi">5000</span><span class="p">)</span>

  <span class="c1">-- Add information from the HTTP call into the headers that are about to be sent to the next</span>
  <span class="c1">-- filter in the filter chain.</span>
  <span class="n">request_handle</span><span class="p">:</span><span class="n">headers</span><span class="p">():</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;upstream_foo&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="p">[</span><span class="s2">&quot;foo&quot;</span><span class="p">])</span>
  <span class="n">request_handle</span><span class="p">:</span><span class="n">headers</span><span class="p">():</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;upstream_body_size&quot;</span><span class="p">,</span> <span class="o">#</span><span class="n">body</span><span class="p">)</span>
<span class="kr">end</span>
</pre></div>
</div>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kr">function</span> <span class="nf">envoy_on_request</span><span class="p">(</span><span class="n">request_handle</span><span class="p">)</span>
  <span class="c1">-- Make an HTTP call.</span>
  <span class="kd">local</span> <span class="n">headers</span><span class="p">,</span> <span class="n">body</span> <span class="o">=</span> <span class="n">request_handle</span><span class="p">:</span><span class="n">httpCall</span><span class="p">(</span>
  <span class="s2">&quot;lua_cluster&quot;</span><span class="p">,</span>
  <span class="p">{</span>
    <span class="p">[</span><span class="s2">&quot;:method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="s2">&quot;:path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="s2">&quot;:authority&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;lua_cluster&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="s2">&quot;set-cookie&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;lang=lua; Path=/&quot;</span><span class="p">,</span> <span class="s2">&quot;type=binding; Path=/&quot;</span> <span class="p">}</span>
  <span class="p">},</span>
  <span class="s2">&quot;hello world&quot;</span><span class="p">,</span>
  <span class="mi">5000</span><span class="p">)</span>

  <span class="c1">-- Response directly and set a header from the HTTP call. No further filter iteration</span>
  <span class="c1">-- occurs.</span>
  <span class="n">request_handle</span><span class="p">:</span><span class="n">respond</span><span class="p">(</span>
    <span class="p">{[</span><span class="s2">&quot;:status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;403&quot;</span><span class="p">,</span>
     <span class="p">[</span><span class="s2">&quot;upstream_foo&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">headers</span><span class="p">[</span><span class="s2">&quot;foo&quot;</span><span class="p">]},</span>
    <span class="s2">&quot;nope&quot;</span><span class="p">)</span>
<span class="kr">end</span>
</pre></div>
</div>
</div>
<div class="section" id="complete-example">
<span id="config-http-filters-lua-stream-handle-api"></span><h2>Complete example<a class="headerlink" href="#complete-example" title="Permalink to this headline">¶</a></h2>
<p>A complete example using Docker is available in <a class="reference external" href="https://github.com/envoyproxy/envoy/blob/ea6903cef0206ec73ccb329efa6209eb21466569//examples/lua">/examples/lua</a>.</p>
</div>
<div class="section" id="stream-handle-api">
<h2>Stream handle API<a class="headerlink" href="#stream-handle-api" title="Permalink to this headline">¶</a></h2>
<p>When Envoy loads the script in the configuration, it looks for two global functions that the
script defines:</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kr">function</span> <span class="nf">envoy_on_request</span><span class="p">(</span><span class="n">request_handle</span><span class="p">)</span>
<span class="kr">end</span>

<span class="kr">function</span> <span class="nf">envoy_on_response</span><span class="p">(</span><span class="n">response_handle</span><span class="p">)</span>
<span class="kr">end</span>
</pre></div>
</div>
<p>A script can define either or both of these functions. During the request path, Envoy will
run <em>envoy_on_request</em> as a coroutine, passing a handle to the request API. During the
response path, Envoy will run <em>envoy_on_response</em> as a coroutine, passing handle to the
response API.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>It is critical that all interaction with Envoy occur through the passed stream handle. The stream
handle should not be assigned to any global variable and should not be used outside of the
coroutine. Envoy will fail your script if the handle is used incorrectly.</p>
</div>
<p>The following methods on the stream handle are supported:</p>
<div class="section" id="headers">
<h3>headers()<a class="headerlink" href="#headers" title="Permalink to this headline">¶</a></h3>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">headers</span> <span class="o">=</span> <span class="n">handle</span><span class="p">:</span><span class="n">headers</span><span class="p">()</span>
</pre></div>
</div>
<p>Returns the stream’s headers. The headers can be modified as long as they have not been sent to
the next filter in the header chain. For example, they can be modified after an <em>httpCall()</em> or
after a <em>body()</em> call returns. The script will fail if the headers are modified in any other
situation.</p>
<p>Returns a <a class="reference internal" href="#config-http-filters-lua-header-wrapper"><span class="std std-ref">header object</span></a>.</p>
</div>
<div class="section" id="body">
<h3>body()<a class="headerlink" href="#body" title="Permalink to this headline">¶</a></h3>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">body</span> <span class="o">=</span> <span class="n">handle</span><span class="p">:</span><span class="n">body</span><span class="p">()</span>
</pre></div>
</div>
<p>Returns the stream’s body. This call will cause Envoy to suspend execution of the script until
the entire body has been received in a buffer. Note that all buffering must adhere to the
flow-control policies in place. Envoy will not buffer more data than is allowed by the connection
manager.</p>
<p>Returns a <a class="reference internal" href="#config-http-filters-lua-buffer-wrapper"><span class="std std-ref">buffer object</span></a>.</p>
</div>
<div class="section" id="bodychunks">
<h3>bodyChunks()<a class="headerlink" href="#bodychunks" title="Permalink to this headline">¶</a></h3>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">iterator</span> <span class="o">=</span> <span class="n">handle</span><span class="p">:</span><span class="n">bodyChunks</span><span class="p">()</span>
</pre></div>
</div>
<p>Returns an iterator that can be used to iterate through all received body chunks as they arrive.
Envoy will suspend executing the script in between chunks, but <em>will not buffer</em> them. This can be
used by a script to inspect data as it is streaming by.</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kr">for</span> <span class="n">chunk</span> <span class="kr">in</span> <span class="n">request_handle</span><span class="p">:</span><span class="n">bodyChunks</span><span class="p">()</span> <span class="kr">do</span>
  <span class="n">request_handle</span><span class="p">:</span><span class="n">log</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">chunk</span><span class="p">:</span><span class="n">length</span><span class="p">())</span>
<span class="kr">end</span>
</pre></div>
</div>
<p>Each chunk the iterator returns is a <a class="reference internal" href="#config-http-filters-lua-buffer-wrapper"><span class="std std-ref">buffer object</span></a>.</p>
</div>
<div class="section" id="trailers">
<h3>trailers()<a class="headerlink" href="#trailers" title="Permalink to this headline">¶</a></h3>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">trailers</span> <span class="o">=</span> <span class="n">handle</span><span class="p">:</span><span class="n">trailers</span><span class="p">()</span>
</pre></div>
</div>
<p>Returns the stream’s trailers. May return nil if there are no trailers. The trailers may be
modified before they are sent to the next filter.</p>
<p>Returns a <a class="reference internal" href="#config-http-filters-lua-header-wrapper"><span class="std std-ref">header object</span></a>.</p>
</div>
<div class="section" id="log">
<h3>log*()<a class="headerlink" href="#log" title="Permalink to this headline">¶</a></h3>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">handle</span><span class="p">:</span><span class="n">logTrace</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<span class="n">handle</span><span class="p">:</span><span class="n">logDebug</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<span class="n">handle</span><span class="p">:</span><span class="n">logInfo</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<span class="n">handle</span><span class="p">:</span><span class="n">logWarn</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<span class="n">handle</span><span class="p">:</span><span class="n">logErr</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<span class="n">handle</span><span class="p">:</span><span class="n">logCritical</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</pre></div>
</div>
<p>Logs a message using Envoy’s application logging. <em>message</em> is a string to log.</p>
</div>
<div class="section" id="httpcall">
<h3>httpCall()<a class="headerlink" href="#httpcall" title="Permalink to this headline">¶</a></h3>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">headers</span><span class="p">,</span> <span class="n">body</span> <span class="o">=</span> <span class="n">handle</span><span class="p">:</span><span class="n">httpCall</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">timeout</span><span class="p">,</span> <span class="n">asynchronous</span><span class="p">)</span>
</pre></div>
</div>
<p>Makes an HTTP call to an upstream host. <em>cluster</em> is a string which maps to a configured cluster manager cluster. <em>headers</em>
is a table of key/value pairs to send (the value can be a string or table of strings). Note that
the <em>:method</em>, <em>:path</em>, and <em>:authority</em> headers must be set. <em>body</em> is an optional string of body
data to send. <em>timeout</em> is an integer that specifies the call timeout in milliseconds.</p>
<p><em>asynchronous</em> is a boolean flag. If asynchronous is set to true, Envoy will make the HTTP request and continue,
regardless of response success or failure. If this is set to false, or not set, Envoy will suspend executing the script
until the call completes or has an error.</p>
<p>Returns <em>headers</em> which is a table of response headers. Returns <em>body</em> which is the string response
body. May be nil if there is no body.</p>
</div>
<div class="section" id="respond">
<h3>respond()<a class="headerlink" href="#respond" title="Permalink to this headline">¶</a></h3>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">handle</span><span class="p">:</span><span class="n">respond</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="n">body</span><span class="p">)</span>
</pre></div>
</div>
<p>Respond immediately and do not continue further filter iteration. This call is <em>only valid in
the request flow</em>. Additionally, a response is only possible if request headers have not yet been
passed to subsequent filters. Meaning, the following Lua code is invalid:</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kr">function</span> <span class="nf">envoy_on_request</span><span class="p">(</span><span class="n">request_handle</span><span class="p">)</span>
  <span class="kr">for</span> <span class="n">chunk</span> <span class="kr">in</span> <span class="n">request_handle</span><span class="p">:</span><span class="n">bodyChunks</span><span class="p">()</span> <span class="kr">do</span>
    <span class="n">request_handle</span><span class="p">:</span><span class="n">respond</span><span class="p">(</span>
      <span class="p">{[</span><span class="s2">&quot;:status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;100&quot;</span><span class="p">},</span>
      <span class="s2">&quot;nope&quot;</span><span class="p">)</span>
  <span class="kr">end</span>
<span class="kr">end</span>
</pre></div>
</div>
<p><em>headers</em> is a table of key/value pairs to send (the value can be a string or table of strings).
Note that the <em>:status</em> header must be set. <em>body</em> is a string and supplies the optional response
body. May be nil.</p>
</div>
<div class="section" id="metadata">
<h3>metadata()<a class="headerlink" href="#metadata" title="Permalink to this headline">¶</a></h3>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">metadata</span> <span class="o">=</span> <span class="n">handle</span><span class="p">:</span><span class="n">metadata</span><span class="p">()</span>
</pre></div>
</div>
<p>Returns the current route entry metadata. Note that the metadata should be specified
under the filter name i.e. <em>envoy.filters.http.lua</em>. Below is an example of a <em>metadata</em> in a
<a class="reference internal" href="../../../api-v3/config/route/v3/route_components.proto.html#envoy-v3-api-msg-config-route-v3-route"><span class="std std-ref">route entry</span></a>.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">filter_metadata</span><span class="p">:</span>
    <span class="nt">envoy.filters.http.lua</span><span class="p">:</span>
      <span class="nt">foo</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bar</span>
      <span class="nt">baz</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bad</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">baz</span>
</pre></div>
</div>
<p>Returns a <a class="reference internal" href="#config-http-filters-lua-metadata-wrapper"><span class="std std-ref">metadata object</span></a>.</p>
</div>
<div class="section" id="streaminfo">
<h3>streamInfo()<a class="headerlink" href="#streaminfo" title="Permalink to this headline">¶</a></h3>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">streamInfo</span> <span class="o">=</span> <span class="n">handle</span><span class="p">:</span><span class="n">streamInfo</span><span class="p">()</span>
</pre></div>
</div>
<p>Returns <a class="reference external" href="https://github.com/envoyproxy/envoy/blob/ea6903cef0206ec73ccb329efa6209eb21466569/include/envoy/stream_info/stream_info.h">information</a> related to the current request.</p>
<p>Returns a <a class="reference internal" href="#config-http-filters-lua-stream-info-wrapper"><span class="std std-ref">stream info object</span></a>.</p>
</div>
<div class="section" id="connection">
<h3>connection()<a class="headerlink" href="#connection" title="Permalink to this headline">¶</a></h3>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">handle</span><span class="p">:</span><span class="n">connection</span><span class="p">()</span>
</pre></div>
</div>
<p>Returns the current request’s underlying <a class="reference external" href="https://github.com/envoyproxy/envoy/blob/ea6903cef0206ec73ccb329efa6209eb21466569/include/envoy/network/connection.h">connection</a>.</p>
<p>Returns a <a class="reference internal" href="#config-http-filters-lua-connection-wrapper"><span class="std std-ref">connection object</span></a>.</p>
</div>
<div class="section" id="importpublickey">
<h3>importPublicKey()<a class="headerlink" href="#importpublickey" title="Permalink to this headline">¶</a></h3>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">pubkey</span> <span class="o">=</span> <span class="n">handle</span><span class="p">:</span><span class="n">importPublicKey</span><span class="p">(</span><span class="n">keyder</span><span class="p">,</span> <span class="n">keyderLength</span><span class="p">)</span>
</pre></div>
</div>
<p>Returns public key which is used by <a class="reference internal" href="#verify-signature"><span class="std std-ref">verifySignature</span></a> to verify digital signature.</p>
</div>
<div class="section" id="verifysignature">
<span id="verify-signature"></span><h3>verifySignature()<a class="headerlink" href="#verifysignature" title="Permalink to this headline">¶</a></h3>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">ok</span><span class="p">,</span> <span class="nb">error</span> <span class="o">=</span> <span class="n">verifySignature</span><span class="p">(</span><span class="n">hashFunction</span><span class="p">,</span> <span class="n">pubkey</span><span class="p">,</span> <span class="n">signature</span><span class="p">,</span> <span class="n">signatureLength</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">dataLength</span><span class="p">)</span>
</pre></div>
</div>
<p>Verify signature using provided parameters. <em>hashFunction</em> is the variable for hash function which be used
for verifying signature. <em>SHA1</em>, <em>SHA224</em>, <em>SHA256</em>, <em>SHA384</em> and <em>SHA512</em> are supported.
<em>pubkey</em> is the public key. <em>signature</em> is the signature to be verified. <em>signatureLength</em> is
the length of the signature. <em>data</em> is the content which will be hashed. <em>dataLength</em> is the length of data.</p>
<p>The function returns a pair. If the first element is <em>true</em>, the second element will be empty
which means signature is verified; otherwise, the second element will store the error message.</p>
</div>
</div>
<div class="section" id="header-object-api">
<span id="config-http-filters-lua-header-wrapper"></span><h2>Header object API<a class="headerlink" href="#header-object-api" title="Permalink to this headline">¶</a></h2>
<div class="section" id="add">
<h3>add()<a class="headerlink" href="#add" title="Permalink to this headline">¶</a></h3>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">headers</span><span class="p">:</span><span class="n">add</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</pre></div>
</div>
<p>Adds a header. <em>key</em> is a string that supplies the header key. <em>value</em> is a string that supplies
the header value.</p>
</div>
<div class="section" id="get">
<h3>get()<a class="headerlink" href="#get" title="Permalink to this headline">¶</a></h3>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">headers</span><span class="p">:</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</pre></div>
</div>
<p>Gets a header. <em>key</em> is a string that supplies the header key. Returns a string that is the header
value or nil if there is no such header.</p>
</div>
<div class="section" id="pairs">
<h3>__pairs()<a class="headerlink" href="#pairs" title="Permalink to this headline">¶</a></h3>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kr">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span> <span class="kr">do</span>
<span class="kr">end</span>
</pre></div>
</div>
<p>Iterates through every header. <em>key</em> is a string that supplies the header key. <em>value</em> is a string
that supplies the header value.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>In the currently implementation, headers cannot be modified during iteration. Additionally, if
it is desired to modify headers after iteration, the iteration must be completed. Meaning, do
not use <cite>break</cite> or any other mechanism to exit the loop early. This may be relaxed in the future.</p>
</div>
</div>
<div class="section" id="remove">
<h3>remove()<a class="headerlink" href="#remove" title="Permalink to this headline">¶</a></h3>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">headers</span><span class="p">:</span><span class="n">remove</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</pre></div>
</div>
<p>Removes a header. <em>key</em> supplies the header key to remove.</p>
</div>
<div class="section" id="replace">
<h3>replace()<a class="headerlink" href="#replace" title="Permalink to this headline">¶</a></h3>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">headers</span><span class="p">:</span><span class="n">replace</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</pre></div>
</div>
<p>Replaces a header. <em>key</em> is a string that supplies the header key. <em>value</em> is a string that supplies
the header value. If the header does not exist, it is added as per the <em>add()</em> function.</p>
</div>
</div>
<div class="section" id="buffer-api">
<span id="config-http-filters-lua-buffer-wrapper"></span><h2>Buffer API<a class="headerlink" href="#buffer-api" title="Permalink to this headline">¶</a></h2>
<div class="section" id="length">
<h3>length()<a class="headerlink" href="#length" title="Permalink to this headline">¶</a></h3>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">size</span> <span class="o">=</span> <span class="n">buffer</span><span class="p">:</span><span class="n">length</span><span class="p">()</span>
</pre></div>
</div>
<p>Gets the size of the buffer in bytes. Returns an integer.</p>
</div>
<div class="section" id="getbytes">
<h3>getBytes()<a class="headerlink" href="#getbytes" title="Permalink to this headline">¶</a></h3>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">buffer</span><span class="p">:</span><span class="n">getBytes</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span>
</pre></div>
</div>
<p>Get bytes from the buffer. By default Envoy will not copy all buffer bytes to Lua. This will
cause a buffer segment to be copied. <em>index</em> is an integer and supplies the buffer start index to
copy. <em>length</em> is an integer and supplies the buffer length to copy. <em>index</em> + <em>length</em> must be
less than the buffer length.</p>
</div>
</div>
<div class="section" id="metadata-object-api">
<span id="config-http-filters-lua-metadata-wrapper"></span><h2>Metadata object API<a class="headerlink" href="#metadata-object-api" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id2">
<h3>get()<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">metadata</span><span class="p">:</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</pre></div>
</div>
<p>Gets a metadata. <em>key</em> is a string that supplies the metadata key. Returns the corresponding
value of the given metadata key. The type of the value can be: <em>nil</em>, <em>boolean</em>, <em>number</em>,
<em>string</em> and <em>table</em>.</p>
</div>
<div class="section" id="id3">
<h3>__pairs()<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kr">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span> <span class="kr">do</span>
<span class="kr">end</span>
</pre></div>
</div>
<p>Iterates through every <em>metadata</em> entry. <em>key</em> is a string that supplies a <em>metadata</em>
key. <em>value</em> is <em>metadata</em> entry value.</p>
</div>
</div>
<div class="section" id="stream-info-object-api">
<span id="config-http-filters-lua-stream-info-wrapper"></span><h2>Stream info object API<a class="headerlink" href="#stream-info-object-api" title="Permalink to this headline">¶</a></h2>
<div class="section" id="protocol">
<h3>protocol()<a class="headerlink" href="#protocol" title="Permalink to this headline">¶</a></h3>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">streamInfo</span><span class="p">:</span><span class="n">protocol</span><span class="p">()</span>
</pre></div>
</div>
<p>Returns the string representation of <a class="reference external" href="https://github.com/envoyproxy/envoy/blob/ea6903cef0206ec73ccb329efa6209eb21466569/include/envoy/http/protocol.h">HTTP protocol</a>
used by the current request. The possible values are: <em>HTTP/1.0</em>, <em>HTTP/1.1</em>, and <em>HTTP/2</em>.</p>
</div>
<div class="section" id="dynamicmetadata">
<h3>dynamicMetadata()<a class="headerlink" href="#dynamicmetadata" title="Permalink to this headline">¶</a></h3>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">streamInfo</span><span class="p">:</span><span class="n">dynamicMetadata</span><span class="p">()</span>
</pre></div>
</div>
<p>Returns a <a class="reference internal" href="#config-http-filters-lua-stream-info-dynamic-metadata-wrapper"><span class="std std-ref">dynamic metadata object</span></a>.</p>
</div>
</div>
<div class="section" id="dynamic-metadata-object-api">
<span id="config-http-filters-lua-stream-info-dynamic-metadata-wrapper"></span><h2>Dynamic metadata object API<a class="headerlink" href="#dynamic-metadata-object-api" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id4">
<h3>get()<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">dynamicMetadata</span><span class="p">:</span><span class="n">get</span><span class="p">(</span><span class="n">filterName</span><span class="p">)</span>

<span class="c1">-- to get a value from a returned table.</span>
<span class="n">dynamicMetadata</span><span class="p">:</span><span class="n">get</span><span class="p">(</span><span class="n">filterName</span><span class="p">)[</span><span class="n">key</span><span class="p">]</span>
</pre></div>
</div>
<p>Gets an entry in dynamic metadata struct. <em>filterName</em> is a string that supplies the filter name, e.g. <em>envoy.lb</em>.
Returns the corresponding <em>table</em> of a given <em>filterName</em>.</p>
</div>
<div class="section" id="set">
<h3>set()<a class="headerlink" href="#set" title="Permalink to this headline">¶</a></h3>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">dynamicMetadata</span><span class="p">:</span><span class="n">set</span><span class="p">(</span><span class="n">filterName</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</pre></div>
</div>
<p>Sets key-value pair of a <em>filterName</em>’s metadata. <em>filterName</em> is a key specifying the target filter name,
e.g. <em>envoy.lb</em>. The type of <em>key</em> is <em>string</em>. The type of <em>value</em> is any Lua type that can be mapped
to a metadata value: <em>table</em>, <em>numeric</em>, <em>boolean</em>, <em>string</em> and <em>nil</em>. When using a <em>table</em> as an argument,
its keys can only be <em>string</em> or <em>numeric</em>.</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kr">function</span> <span class="nf">envoy_on_request</span><span class="p">(</span><span class="n">request_handle</span><span class="p">)</span>
  <span class="kd">local</span> <span class="n">headers</span> <span class="o">=</span> <span class="n">request_handle</span><span class="p">:</span><span class="n">headers</span><span class="p">()</span>
  <span class="n">request_handle</span><span class="p">:</span><span class="n">streamInfo</span><span class="p">():</span><span class="n">dynamicMetadata</span><span class="p">():</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;envoy.filters.http.lua&quot;</span><span class="p">,</span> <span class="s2">&quot;request.info&quot;</span><span class="p">,</span> <span class="p">{</span>
    <span class="n">auth</span><span class="p">:</span> <span class="n">headers</span><span class="p">:</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;authorization&quot;</span><span class="p">),</span>
    <span class="n">token</span><span class="p">:</span> <span class="n">headers</span><span class="p">:</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x-request-token&quot;</span><span class="p">),</span>
  <span class="p">})</span>
<span class="kr">end</span>

<span class="kr">function</span> <span class="nf">envoy_on_response</span><span class="p">(</span><span class="n">response_handle</span><span class="p">)</span>
  <span class="kd">local</span> <span class="n">meta</span> <span class="o">=</span> <span class="n">response_handle</span><span class="p">:</span><span class="n">streamInfo</span><span class="p">():</span><span class="n">dynamicMetadata</span><span class="p">()[</span><span class="s2">&quot;request.info&quot;</span><span class="p">]</span>
  <span class="n">response_handle</span><span class="p">:</span><span class="n">logInfo</span><span class="p">(</span><span class="s2">&quot;Auth: &quot;</span><span class="o">..</span><span class="n">meta</span><span class="p">.</span><span class="n">auth</span><span class="o">..</span><span class="s2">&quot;, token: &quot;</span><span class="o">..</span><span class="n">meta</span><span class="p">.</span><span class="n">token</span><span class="p">)</span>
<span class="kr">end</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h3>__pairs()<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kr">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">dynamicMetadata</span><span class="p">)</span> <span class="kr">do</span>
<span class="kr">end</span>
</pre></div>
</div>
<p>Iterates through every <em>dynamicMetadata</em> entry. <em>key</em> is a string that supplies a <em>dynamicMetadata</em>
key. <em>value</em> is <em>dynamicMetadata</em> entry value.</p>
</div>
</div>
<div class="section" id="connection-object-api">
<span id="config-http-filters-lua-connection-wrapper"></span><h2>Connection object API<a class="headerlink" href="#connection-object-api" title="Permalink to this headline">¶</a></h2>
<div class="section" id="ssl">
<h3>ssl()<a class="headerlink" href="#ssl" title="Permalink to this headline">¶</a></h3>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kr">if</span> <span class="n">connection</span><span class="p">:</span><span class="n">ssl</span><span class="p">()</span> <span class="o">==</span> <span class="kc">nil</span> <span class="kr">then</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;plain&quot;</span><span class="p">)</span>
<span class="kr">else</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;secure&quot;</span><span class="p">)</span>
<span class="kr">end</span>
</pre></div>
</div>
<p>Returns <a class="reference external" href="https://github.com/envoyproxy/envoy/blob/ea6903cef0206ec73ccb329efa6209eb21466569/include/envoy/ssl/connection.h">SSL connection</a> object when the connection is
secured and <em>nil</em> when it is not.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Currently the SSL connection object has no exposed APIs.</p>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="on_demand_updates_filter.html" class="btn btn-neutral float-right" title="On-demand VHDS Updates" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="jwt_authn_filter.html" class="btn btn-neutral float-left" title="JWT Authentication" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016-2020, Envoy Project Authors

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>