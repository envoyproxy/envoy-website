

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Fault Injection &mdash; envoy 1.17.0-dev-d1ded6 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/envoy.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/sphinx_tabs/semantic-ui-2.4.1/segment.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/sphinx_tabs/semantic-ui-2.4.1/menu.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/sphinx_tabs/semantic-ui-2.4.1/tab.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/sphinx_tabs/tabs.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/copybutton.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
        <script src="../../../_static/clipboard.min.js"></script>
        <script src="../../../_static/copybutton.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="gRPC HTTP/1.1 bridge" href="grpc_http1_bridge_filter.html" />
    <link rel="prev" title="External Processing" href="ext_proc_filter.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html">
          

          
            
            <img src="../../../_static/envoy-logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.17.0-dev-d1ded6
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../about_docs.html">About the documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../intro/intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../start/start.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../configuration.html">Configuration reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../overview/overview.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../listeners/listeners.html">Listeners</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../http.html">HTTP</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../http_conn_man/http_conn_man.html">HTTP connection manager</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="http_filters.html">HTTP filters</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="adaptive_concurrency_filter.html">Adaptive Concurrency</a></li>
<li class="toctree-l4"><a class="reference internal" href="admission_control_filter.html">Admission Control</a></li>
<li class="toctree-l4"><a class="reference internal" href="aws_lambda_filter.html">AWS Lambda</a></li>
<li class="toctree-l4"><a class="reference internal" href="aws_request_signing_filter.html">AWS Request Signing</a></li>
<li class="toctree-l4"><a class="reference internal" href="buffer_filter.html">Buffer</a></li>
<li class="toctree-l4"><a class="reference internal" href="cdn_loop_filter.html">CDN-Loop header</a></li>
<li class="toctree-l4"><a class="reference internal" href="compressor_filter.html">Compressor</a></li>
<li class="toctree-l4"><a class="reference internal" href="cors_filter.html">CORS</a></li>
<li class="toctree-l4"><a class="reference internal" href="csrf_filter.html">CSRF</a></li>
<li class="toctree-l4"><a class="reference internal" href="decompressor_filter.html">Decompressor</a></li>
<li class="toctree-l4"><a class="reference internal" href="dynamic_forward_proxy_filter.html">Dynamic forward proxy</a></li>
<li class="toctree-l4"><a class="reference internal" href="dynamodb_filter.html">DynamoDB</a></li>
<li class="toctree-l4"><a class="reference internal" href="ext_authz_filter.html">External Authorization</a></li>
<li class="toctree-l4"><a class="reference internal" href="ext_proc_filter.html">External Processing</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Fault Injection</a></li>
<li class="toctree-l4"><a class="reference internal" href="grpc_http1_bridge_filter.html">gRPC HTTP/1.1 bridge</a></li>
<li class="toctree-l4"><a class="reference internal" href="grpc_http1_reverse_bridge_filter.html">gRPC HTTP/1.1 reverse bridge</a></li>
<li class="toctree-l4"><a class="reference internal" href="grpc_json_transcoder_filter.html">gRPC-JSON transcoder</a></li>
<li class="toctree-l4"><a class="reference internal" href="grpc_stats_filter.html">gRPC Statistics</a></li>
<li class="toctree-l4"><a class="reference internal" href="grpc_web_filter.html">gRPC-Web</a></li>
<li class="toctree-l4"><a class="reference internal" href="gzip_filter.html">Gzip</a></li>
<li class="toctree-l4"><a class="reference internal" href="health_check_filter.html">Health check</a></li>
<li class="toctree-l4"><a class="reference internal" href="header_to_metadata_filter.html">Envoy Header-To-Metadata Filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="ip_tagging_filter.html">IP Tagging</a></li>
<li class="toctree-l4"><a class="reference internal" href="jwt_authn_filter.html">JWT Authentication</a></li>
<li class="toctree-l4"><a class="reference internal" href="kill_request_filter.html">Kill Request</a></li>
<li class="toctree-l4"><a class="reference internal" href="local_rate_limit_filter.html">Local rate limit</a></li>
<li class="toctree-l4"><a class="reference internal" href="lua_filter.html">Lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="oauth2_filter.html">OAuth2</a></li>
<li class="toctree-l4"><a class="reference internal" href="on_demand_updates_filter.html">On-demand VHDS and S/RDS Updates</a></li>
<li class="toctree-l4"><a class="reference internal" href="original_src_filter.html">Original Source</a></li>
<li class="toctree-l4"><a class="reference internal" href="rate_limit_filter.html">Rate limit</a></li>
<li class="toctree-l4"><a class="reference internal" href="rbac_filter.html">Role Based Access Control (RBAC) Filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="router_filter.html">Router</a></li>
<li class="toctree-l4"><a class="reference internal" href="squash_filter.html">Squash</a></li>
<li class="toctree-l4"><a class="reference internal" href="tap_filter.html">Tap</a></li>
<li class="toctree-l4"><a class="reference internal" href="wasm_filter.html">Wasm</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../upstream/upstream.html">Upstream clusters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../observability/observability.html">Observability</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../security/security.html">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../operations/operations.html">Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../other_features/other_features.html">Other features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../other_protocols/other_protocols.html">Other protocols</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../advanced/advanced.html">Advanced</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../best_practices/best_practices.html">Configuration best practices</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../operations/operations.html">Operations and administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../extending/extending.html">Extending Envoy for custom use cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../faq/overview.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../version_history/version_history.html">Version history</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">envoy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../configuration.html">Configuration reference</a> &raquo;</li>
        
          <li><a href="../http.html">HTTP</a> &raquo;</li>
        
          <li><a href="http_filters.html">HTTP filters</a> &raquo;</li>
        
      <li>Fault Injection</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/configuration/http/http_filters/fault_filter.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="fault-injection">
<span id="config-http-filters-fault-injection"></span><h1>Fault Injection<a class="headerlink" href="#fault-injection" title="Permalink to this headline">¶</a></h1>
<p>The fault injection filter can be used to test the resiliency of
microservices to different forms of failures. The filter can be used to
inject delays and abort requests with user-specified error codes, thereby
providing the ability to stage different failure scenarios such as service
failures, service overloads, high network latency, network partitions,
etc. Faults injection can be limited to a specific set of requests based on
the (destination) upstream cluster of a request and/or a set of pre-defined
request headers.</p>
<p>The scope of failures is restricted to those that are observable by an
application communicating over the network. CPU and disk failures on the
local host cannot be emulated.</p>
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The fault injection filter must be inserted before any other filter,
including the router filter.</p>
</div>
<ul class="simple">
<li><p><a class="reference internal" href="../../../api-v3/extensions/filters/http/fault/v3/fault.proto.html#envoy-v3-api-msg-extensions-filters-http-fault-v3-httpfault"><span class="std std-ref">v3 API reference</span></a></p></li>
<li><p>This filter should be configured with the name <em>envoy.filters.http.fault</em>.</p></li>
</ul>
</div>
<div class="section" id="controlling-fault-injection-via-http-headers">
<span id="config-http-filters-fault-injection-http-header"></span><h2>Controlling fault injection via HTTP headers<a class="headerlink" href="#controlling-fault-injection-via-http-headers" title="Permalink to this headline">¶</a></h2>
<p>The fault filter has the capability to allow fault configuration to be specified by the caller.
This is useful in certain scenarios in which it is desired to allow the client to specify its own
fault configuration. The currently supported header controls are:</p>
<dl class="simple">
<dt>x-envoy-fault-abort-request</dt><dd><p>HTTP status code to abort a request with. The header value should be an integer that specifies
the HTTP status code to return in response to a request and must be in the range [200, 600).
In order for the header to work, <a class="reference internal" href="../../../api-v3/extensions/filters/http/fault/v3/fault.proto.html#envoy-v3-api-field-extensions-filters-http-fault-v3-faultabort-header-abort"><span class="std std-ref">header_abort</span></a> needs to be set.</p>
</dd>
<dt>x-envoy-fault-abort-grpc-request</dt><dd><p>gRPC status code to abort a request with. The header value should be a non-negative integer that specifies
the gRPC status code to return in response to a request. Its value range is [0, UInt32.Max] instead of [0, 16]
to allow testing even not well-defined gRPC status codes. When this header is set, the HTTP response status code
will be set to 200. In order for the header to work, <a class="reference internal" href="../../../api-v2/config/filter/http/fault/v2/fault.proto.html#envoy-api-field-config-filter-http-fault-v2-faultabort-header-abort"><span class="std std-ref">header_abort</span></a> needs to be set. If both
<em>x-envoy-fault-abort-request</em> and <em>x-envoy-fault-abort-grpc-request</em> headers are set then
<em>x-envoy-fault-abort-grpc-request</em> header will be <strong>ignored</strong> and fault response http status code will be
set to <em>x-envoy-fault-abort-request</em> header value.</p>
</dd>
<dt>x-envoy-fault-abort-request-percentage</dt><dd><p>The percentage of requests that should be failed with a status code that’s defined
by the value of <em>x-envoy-fault-abort-request</em> or <em>x-envoy-fault-abort-grpc-request</em> HTTP headers.
The header value should be an integer that specifies the numerator of the percentage of request to apply aborts
to and must be greater or equal to 0 and its maximum value is capped by the value of the numerator of
<a class="reference internal" href="../../../api-v3/extensions/filters/http/fault/v3/fault.proto.html#envoy-v3-api-field-extensions-filters-http-fault-v3-faultabort-percentage"><span class="std std-ref">percentage</span></a> field.
Percentage’s denominator is equal to default percentage’s denominator
<a class="reference internal" href="../../../api-v3/extensions/filters/http/fault/v3/fault.proto.html#envoy-v3-api-field-extensions-filters-http-fault-v3-faultabort-percentage"><span class="std std-ref">percentage</span></a> field.
In order for the header to work, <a class="reference internal" href="../../../api-v3/extensions/filters/http/fault/v3/fault.proto.html#envoy-v3-api-field-extensions-filters-http-fault-v3-faultabort-header-abort"><span class="std std-ref">header_abort</span></a> needs to be set and
either <em>x-envoy-fault-abort-request</em> or <em>x-envoy-fault-abort-grpc-request</em> HTTP header needs to be a part of the request.</p>
</dd>
<dt>x-envoy-fault-delay-request</dt><dd><p>The duration to delay a request by. The header value should be an integer that specifies the number
of milliseconds to throttle the latency for. In order for the header to work, <a class="reference internal" href="../../../api-v3/extensions/filters/common/fault/v3/fault.proto.html#envoy-v3-api-field-extensions-filters-common-fault-v3-faultdelay-header-delay"><span class="std std-ref">header_delay</span></a> needs to be set.</p>
</dd>
<dt>x-envoy-fault-delay-request-percentage</dt><dd><p>The percentage of requests that should be delayed by a duration that’s defined by the value of
<em>x-envoy-fault-delay-request</em> HTTP header. The header value should be an integer that
specifies the percentage of request to apply delays to and must be greater
or equal to 0 and its maximum value is capped by the value of the numerator of
<a class="reference internal" href="../../../api-v3/extensions/filters/common/fault/v3/fault.proto.html#envoy-v3-api-field-extensions-filters-common-fault-v3-faultdelay-percentage"><span class="std std-ref">percentage</span></a> field.
Percentage’s denominator is equal to default percentage’s denominator
<a class="reference internal" href="../../../api-v3/extensions/filters/common/fault/v3/fault.proto.html#envoy-v3-api-field-extensions-filters-common-fault-v3-faultdelay-percentage"><span class="std std-ref">percentage</span></a> field.
In order for the header to work, <a class="reference internal" href="../../../api-v3/extensions/filters/common/fault/v3/fault.proto.html#envoy-v3-api-field-extensions-filters-common-fault-v3-faultdelay-header-delay"><span class="std std-ref">header_delay</span></a> needs to be set and
<em>x-envoy-fault-delay-request</em> HTTP header needs to be a part of a request.</p>
</dd>
<dt>x-envoy-fault-throughput-response</dt><dd><p>The rate limit to use when a response to a caller is sent. The header value should be an integer
that specifies the limit in KiB/s and must be &gt; 0. In order for the header to work, <a class="reference internal" href="../../../api-v3/extensions/filters/common/fault/v3/fault.proto.html#envoy-v3-api-field-extensions-filters-common-fault-v3-faultratelimit-header-limit"><span class="std std-ref">header_limit</span></a> needs to be set.</p>
</dd>
<dt>x-envoy-fault-throughput-response-percentage</dt><dd><p>The percentage of requests whose response rate should be limited to the value of
<em>x-envoy-fault-throughput-response</em> HTTP header. The header value should be an integer that
specifies the percentage of request to apply delays to and must be greater
or equal to 0 and its maximum value is capped by the value of the numerator of
<a class="reference internal" href="../../../api-v3/extensions/filters/common/fault/v3/fault.proto.html#envoy-v3-api-field-extensions-filters-common-fault-v3-faultratelimit-percentage"><span class="std std-ref">percentage</span></a> field.
Percentage’s denominator is equal to default percentage’s denominator
<a class="reference internal" href="../../../api-v3/extensions/filters/common/fault/v3/fault.proto.html#envoy-v3-api-field-extensions-filters-common-fault-v3-faultratelimit-percentage"><span class="std std-ref">percentage</span></a> field.
In order for the header to work, <a class="reference internal" href="../../../api-v3/extensions/filters/common/fault/v3/fault.proto.html#envoy-v3-api-field-extensions-filters-common-fault-v3-faultratelimit-header-limit"><span class="std std-ref">header_limit</span></a> needs to be set and
<em>x-envoy-fault-delay-request</em> HTTP header needs to be a part of a request.</p>
</dd>
</dl>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Allowing header control is inherently dangerous if exposed to untrusted clients. In this case,
it is suggested to use the <a class="reference internal" href="../../../api-v3/extensions/filters/http/fault/v3/fault.proto.html#envoy-v3-api-field-extensions-filters-http-fault-v3-httpfault-max-active-faults"><span class="std std-ref">max_active_faults</span></a> setting to limit the
maximum concurrent faults that can be active at any given time.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the headers appear multiple times only the first value is used.</p>
</div>
<p>The following is an example configuration that enables header control for both of the above
options:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">envoy.filters.http.fault</span>
<span class="nt">typed_config</span><span class="p">:</span>
  <span class="s">&quot;@type&quot;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">type.googleapis.com/envoy.extensions.filters.http.fault.v3.HTTPFault</span>
  <span class="nt">max_active_faults</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">100</span>
  <span class="nt">abort</span><span class="p">:</span>
    <span class="nt">header_abort</span><span class="p">:</span> <span class="p p-Indicator">{}</span>
    <span class="nt">percentage</span><span class="p">:</span>
      <span class="nt">numerator</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">100</span>
  <span class="nt">delay</span><span class="p">:</span>
    <span class="nt">header_delay</span><span class="p">:</span> <span class="p p-Indicator">{}</span>
    <span class="nt">percentage</span><span class="p">:</span>
      <span class="nt">numerator</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">100</span>
  <span class="nt">response_rate_limit</span><span class="p">:</span>
    <span class="nt">header_limit</span><span class="p">:</span> <span class="p p-Indicator">{}</span>
    <span class="nt">percentage</span><span class="p">:</span>
      <span class="nt">numerator</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">100</span>
</pre></div>
</div>
</div>
<div class="section" id="runtime">
<span id="config-http-filters-fault-injection-runtime"></span><h2>Runtime<a class="headerlink" href="#runtime" title="Permalink to this headline">¶</a></h2>
<p>The HTTP fault injection filter supports the following global runtime settings:</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Some of the following runtime keys require the filter to be configured for the specific fault
type and some do not. Please consult the documentation for each key for more information.</p>
</div>
<dl class="simple">
<dt>fault.http.abort.abort_percent</dt><dd><p>% of requests that will be aborted if the headers match. Defaults to the
<em>abort_percent</em> specified in config. If the config does not contain an
<em>abort</em> block, then <em>abort_percent</em> defaults to 0. For historic reasons, this runtime key is
available regardless of whether the filter is <a class="reference internal" href="../../../api-v3/extensions/filters/http/fault/v3/fault.proto.html#envoy-v3-api-field-extensions-filters-http-fault-v3-httpfault-abort"><span class="std std-ref">configured for abort</span></a>.</p>
</dd>
<dt>fault.http.abort.http_status</dt><dd><p>HTTP status code that will be used as the response status code of requests that will be
aborted if the headers match. Defaults to the HTTP status code specified
in the config. If the config does not contain an <em>abort</em> block, then
<em>http_status</em> defaults to 0. For historic reasons, this runtime key is
available regardless of whether the filter is <a class="reference internal" href="../../../api-v3/extensions/filters/http/fault/v3/fault.proto.html#envoy-v3-api-field-extensions-filters-http-fault-v3-httpfault-abort"><span class="std std-ref">configured for abort</span></a>.</p>
</dd>
<dt>fault.http.abort.grpc_status</dt><dd><p>gRPC status code that will be used as the response status code of requests that will be
aborted if the headers match. Defaults to the gRPC status code specified in the config.
If this field is missing from both the runtime and the config, gRPC status code in the response
will be derived from <em>fault.http.abort.http_status</em> field. This runtime key is only available when
the filter is <a class="reference internal" href="../../../api-v2/config/filter/http/fault/v2/fault.proto.html#envoy-api-field-config-filter-http-fault-v2-httpfault-abort"><span class="std std-ref">configured for abort</span></a>.</p>
</dd>
<dt>fault.http.delay.fixed_delay_percent</dt><dd><p>% of requests that will be delayed if the headers match. Defaults to the
<em>delay_percent</em> specified in the config or 0 otherwise. This runtime key is only available when
the filter is <a class="reference internal" href="../../../api-v3/extensions/filters/http/fault/v3/fault.proto.html#envoy-v3-api-field-extensions-filters-http-fault-v3-httpfault-delay"><span class="std std-ref">configured for delay</span></a>.</p>
</dd>
<dt>fault.http.delay.fixed_duration_ms</dt><dd><p>The delay duration in milliseconds. If not specified, the
<em>fixed_duration_ms</em> specified in the config will be used. If this field
is missing from both the runtime and the config, no delays will be
injected. This runtime key is only available when the filter is <a class="reference internal" href="../../../api-v3/extensions/filters/http/fault/v3/fault.proto.html#envoy-v3-api-field-extensions-filters-http-fault-v3-httpfault-delay"><span class="std std-ref">configured for delay</span></a>.</p>
</dd>
<dt>fault.http.max_active_faults</dt><dd><p>The maximum number of active faults (of all types) that Envoy will will inject via the fault
filter. This can be used in cases where it is desired that faults are 100% injected,
but the user wants to avoid a situation in which too many unexpected concurrent faulting requests
cause resource constraint issues. If not specified, the <a class="reference internal" href="../../../api-v3/extensions/filters/http/fault/v3/fault.proto.html#envoy-v3-api-field-extensions-filters-http-fault-v3-httpfault-max-active-faults"><span class="std std-ref">max_active_faults</span></a> setting will be used.</p>
</dd>
<dt>fault.http.rate_limit.response_percent</dt><dd><p>% of requests which will have a response rate limit fault injected. Defaults to the value set in
the <a class="reference internal" href="../../../api-v3/extensions/filters/common/fault/v3/fault.proto.html#envoy-v3-api-field-extensions-filters-common-fault-v3-faultratelimit-percentage"><span class="std std-ref">percentage</span></a> field.
This runtime key is only available when the filter is <a class="reference internal" href="../../../api-v3/extensions/filters/http/fault/v3/fault.proto.html#envoy-v3-api-field-extensions-filters-http-fault-v3-httpfault-response-rate-limit"><span class="std std-ref">configured for response rate limiting</span></a>.</p>
</dd>
</dl>
<p><em>Note</em>, fault filter runtime settings for the specific downstream cluster
override the default ones if present. The following are downstream specific
runtime keys:</p>
<ul class="simple">
<li><p>fault.http.&lt;downstream-cluster&gt;.abort.abort_percent</p></li>
<li><p>fault.http.&lt;downstream-cluster&gt;.abort.http_status</p></li>
<li><p>fault.http.&lt;downstream-cluster&gt;.delay.fixed_delay_percent</p></li>
<li><p>fault.http.&lt;downstream-cluster&gt;.delay.fixed_duration_ms</p></li>
</ul>
<p>Downstream cluster name is taken from
<a class="reference internal" href="../http_conn_man/headers.html#config-http-conn-man-headers-downstream-service-cluster"><span class="std std-ref">the HTTP x-envoy-downstream-service-cluster</span></a>
header. If the following settings are not found in the runtime it defaults to the global runtime settings
which defaults to the config settings.</p>
</div>
<div class="section" id="statistics">
<span id="config-http-filters-fault-injection-stats"></span><h2>Statistics<a class="headerlink" href="#statistics" title="Permalink to this headline">¶</a></h2>
<p>The fault filter outputs statistics in the <em>http.&lt;stat_prefix&gt;.fault.</em> namespace. The <a class="reference internal" href="../../../api-v3/extensions/filters/network/http_connection_manager/v3/http_connection_manager.proto.html#envoy-v3-api-field-extensions-filters-network-http-connection-manager-v3-httpconnectionmanager-stat-prefix"><span class="std std-ref">stat prefix</span></a> comes from the
owning HTTP connection manager.</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>delays_injected</p></td>
<td><p>Counter</p></td>
<td><p>Total requests that were delayed</p></td>
</tr>
<tr class="row-odd"><td><p>aborts_injected</p></td>
<td><p>Counter</p></td>
<td><p>Total requests that were aborted</p></td>
</tr>
<tr class="row-even"><td><p>response_rl_injected</p></td>
<td><p>Counter</p></td>
<td><p>Total requests that had a response rate limit selected for injection (actually injection may not occur due to disconnect, reset, no body, etc.)</p></td>
</tr>
<tr class="row-odd"><td><p>faults_overflow</p></td>
<td><p>Counter</p></td>
<td><p>Total number of faults that were not injected due to overflowing the <a class="reference internal" href="../../../api-v3/extensions/filters/http/fault/v3/fault.proto.html#envoy-v3-api-field-extensions-filters-http-fault-v3-httpfault-max-active-faults"><span class="std std-ref">max_active_faults</span></a> setting</p></td>
</tr>
<tr class="row-even"><td><p>active_faults</p></td>
<td><p>Gauge</p></td>
<td><p>Total number of faults active at the current time</p></td>
</tr>
<tr class="row-odd"><td><p>&lt;downstream-cluster&gt;.delays_injected</p></td>
<td><p>Counter</p></td>
<td><p>Total delayed requests for the given downstream cluster</p></td>
</tr>
<tr class="row-even"><td><p>&lt;downstream-cluster&gt;.aborts_injected</p></td>
<td><p>Counter</p></td>
<td><p>Total aborted requests for the given downstream cluster</p></td>
</tr>
</tbody>
</table>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="grpc_http1_bridge_filter.html" class="btn btn-neutral float-right" title="gRPC HTTP/1.1 bridge" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="ext_proc_filter.html" class="btn btn-neutral float-left" title="External Processing" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2016-2020, Envoy Project Authors

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>