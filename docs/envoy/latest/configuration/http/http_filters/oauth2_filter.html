

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>OAuth2 &mdash; envoy 1.19.0-dev-2971bf documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/envoy.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/tabs.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/copybutton.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/clipboard.min.js"></script>
        <script src="../../../_static/copybutton.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="On-demand VHDS and S/RDS Updates" href="on_demand_updates_filter.html" />
    <link rel="prev" title="Lua" href="lua_filter.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html">
          

          
            
            <img src="../../../_static/envoy-logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.19.0-dev-2971bf
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../about_docs.html">About the documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../intro/intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../start/start.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../configuration.html">Configuration reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../overview/overview.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../listeners/listeners.html">Listeners</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../http.html">HTTP</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../http_conn_man/http_conn_man.html">HTTP connection manager</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="http_filters.html">HTTP filters</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="adaptive_concurrency_filter.html">Adaptive Concurrency</a></li>
<li class="toctree-l4"><a class="reference internal" href="admission_control_filter.html">Admission Control</a></li>
<li class="toctree-l4"><a class="reference internal" href="aws_lambda_filter.html">AWS Lambda</a></li>
<li class="toctree-l4"><a class="reference internal" href="aws_request_signing_filter.html">AWS Request Signing</a></li>
<li class="toctree-l4"><a class="reference internal" href="buffer_filter.html">Buffer</a></li>
<li class="toctree-l4"><a class="reference internal" href="cdn_loop_filter.html">CDN-Loop header</a></li>
<li class="toctree-l4"><a class="reference internal" href="compressor_filter.html">Compressor</a></li>
<li class="toctree-l4"><a class="reference internal" href="composite_filter.html">Composite Filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="cors_filter.html">CORS</a></li>
<li class="toctree-l4"><a class="reference internal" href="csrf_filter.html">CSRF</a></li>
<li class="toctree-l4"><a class="reference internal" href="decompressor_filter.html">Decompressor</a></li>
<li class="toctree-l4"><a class="reference internal" href="dynamic_forward_proxy_filter.html">Dynamic forward proxy</a></li>
<li class="toctree-l4"><a class="reference internal" href="dynamodb_filter.html">DynamoDB</a></li>
<li class="toctree-l4"><a class="reference internal" href="ext_authz_filter.html">External Authorization</a></li>
<li class="toctree-l4"><a class="reference internal" href="ext_proc_filter.html">External Processing</a></li>
<li class="toctree-l4"><a class="reference internal" href="fault_filter.html">Fault Injection</a></li>
<li class="toctree-l4"><a class="reference internal" href="grpc_http1_bridge_filter.html">gRPC HTTP/1.1 bridge</a></li>
<li class="toctree-l4"><a class="reference internal" href="grpc_http1_reverse_bridge_filter.html">gRPC HTTP/1.1 reverse bridge</a></li>
<li class="toctree-l4"><a class="reference internal" href="grpc_json_transcoder_filter.html">gRPC-JSON transcoder</a></li>
<li class="toctree-l4"><a class="reference internal" href="grpc_stats_filter.html">gRPC Statistics</a></li>
<li class="toctree-l4"><a class="reference internal" href="grpc_web_filter.html">gRPC-Web</a></li>
<li class="toctree-l4"><a class="reference internal" href="gzip_filter.html">Gzip</a></li>
<li class="toctree-l4"><a class="reference internal" href="health_check_filter.html">Health check</a></li>
<li class="toctree-l4"><a class="reference internal" href="header_to_metadata_filter.html">Envoy Header-To-Metadata Filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="ip_tagging_filter.html">IP Tagging</a></li>
<li class="toctree-l4"><a class="reference internal" href="jwt_authn_filter.html">JWT Authentication</a></li>
<li class="toctree-l4"><a class="reference internal" href="kill_request_filter.html">Kill Request</a></li>
<li class="toctree-l4"><a class="reference internal" href="local_rate_limit_filter.html">Local rate limit</a></li>
<li class="toctree-l4"><a class="reference internal" href="lua_filter.html">Lua</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">OAuth2</a></li>
<li class="toctree-l4"><a class="reference internal" href="on_demand_updates_filter.html">On-demand VHDS and S/RDS Updates</a></li>
<li class="toctree-l4"><a class="reference internal" href="original_src_filter.html">Original Source</a></li>
<li class="toctree-l4"><a class="reference internal" href="rate_limit_filter.html">Rate limit</a></li>
<li class="toctree-l4"><a class="reference internal" href="rbac_filter.html">Role Based Access Control (RBAC) Filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="router_filter.html">Router</a></li>
<li class="toctree-l4"><a class="reference internal" href="squash_filter.html">Squash</a></li>
<li class="toctree-l4"><a class="reference internal" href="tap_filter.html">Tap</a></li>
<li class="toctree-l4"><a class="reference internal" href="wasm_filter.html">Wasm</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../upstream/upstream.html">Upstream clusters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../observability/observability.html">Observability</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../security/security.html">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../operations/operations.html">Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../other_features/other_features.html">Other features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../other_protocols/other_protocols.html">Other protocols</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../advanced/advanced.html">Advanced</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../best_practices/best_practices.html">Configuration best practices</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../operations/operations.html">Operations and administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../extending/extending.html">Extending Envoy for custom use cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../faq/overview.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../version_history/version_history.html">Version history</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">envoy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../configuration.html">Configuration reference</a> &raquo;</li>
        
          <li><a href="../http.html">HTTP</a> &raquo;</li>
        
          <li><a href="http_filters.html">HTTP filters</a> &raquo;</li>
        
      <li>OAuth2</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../_sources/configuration/http/http_filters/oauth2_filter.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="oauth2">
<span id="config-http-filters-oauth"></span><h1>OAuth2<a class="headerlink" href="#oauth2" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p><a class="reference internal" href="../../../api-v3/extensions/filters/http/oauth2/v3alpha/oauth.proto.html#envoy-v3-api-msg-extensions-filters-http-oauth2-v3alpha-oauth2"><span class="std std-ref">v3 API reference</span></a></p></li>
<li><p>This filter should be configured with the name <em>envoy.filters.http.oauth2</em>.</p></li>
</ul>
<p>The OAuth filter’s flow involves:</p>
<ul class="simple">
<li><p>An unauthenticated user arrives at myapp.com, and the oauth filter redirects them to the
<a class="reference internal" href="../../../api-v3/extensions/filters/http/oauth2/v3alpha/oauth.proto.html#envoy-v3-api-field-extensions-filters-http-oauth2-v3alpha-oauth2config-authorization-endpoint"><span class="std std-ref">authorization_endpoint</span></a>
for login. The <a class="reference internal" href="../../../api-v3/extensions/filters/http/oauth2/v3alpha/oauth.proto.html#envoy-v3-api-field-extensions-filters-http-oauth2-v3alpha-oauth2credentials-client-id"><span class="std std-ref">client_id</span></a>
and the <a class="reference internal" href="../../../api-v3/extensions/filters/http/oauth2/v3alpha/oauth.proto.html#envoy-v3-api-field-extensions-filters-http-oauth2-v3alpha-oauth2config-redirect-uri"><span class="std std-ref">redirect_uri</span></a>
are sent as query string parameters in this first redirect.</p></li>
<li><p>After a successful login, the authn server should be configured to redirect the user back to the
<a class="reference internal" href="../../../api-v3/extensions/filters/http/oauth2/v3alpha/oauth.proto.html#envoy-v3-api-field-extensions-filters-http-oauth2-v3alpha-oauth2config-redirect-uri"><span class="std std-ref">redirect_uri</span></a>
provided in the query string in the first step. In the below code example, we choose /callback as the configured match path.
An “authorization grant” is included in the query string for this second redirect.</p></li>
<li><p>Using this new grant and the <a class="reference internal" href="../../../api-v3/extensions/filters/http/oauth2/v3alpha/oauth.proto.html#envoy-v3-api-field-extensions-filters-http-oauth2-v3alpha-oauth2credentials-token-secret"><span class="std std-ref">token_secret</span></a>,
the filter then attempts to retrieve an access token from
the <a class="reference internal" href="../../../api-v3/extensions/filters/http/oauth2/v3alpha/oauth.proto.html#envoy-v3-api-field-extensions-filters-http-oauth2-v3alpha-oauth2config-token-endpoint"><span class="std std-ref">token_endpoint</span></a>. The filter knows it has to do this
instead of reinitiating another login because the incoming request has a path that matches the
<a class="reference internal" href="../../../api-v3/extensions/filters/http/oauth2/v3alpha/oauth.proto.html#envoy-v3-api-field-extensions-filters-http-oauth2-v3alpha-oauth2config-redirect-path-matcher"><span class="std std-ref">redirect_path_matcher</span></a> criteria.</p></li>
<li><p>Upon receiving an access token, the filter sets cookies so that subseqeuent requests can skip the full
flow. These cookies are calculated using the
<a class="reference internal" href="../../../api-v3/extensions/filters/http/oauth2/v3alpha/oauth.proto.html#envoy-v3-api-field-extensions-filters-http-oauth2-v3alpha-oauth2credentials-hmac-secret"><span class="std std-ref">hmac_secret</span></a>
to assist in encoding.</p></li>
<li><p>The filter calls continueDecoding() to unblock the filter chain.</p></li>
</ul>
<p>When the authn server validates the client and returns an authorization token back to the OAuth filter,
no matter what format that token is, if
<a class="reference internal" href="../../../api-v3/extensions/filters/http/oauth2/v3alpha/oauth.proto.html#envoy-v3-api-field-extensions-filters-http-oauth2-v3alpha-oauth2config-forward-bearer-token"><span class="std std-ref">forward_bearer_token</span></a>
is set to true the filter will send over a
cookie named <cite>BearerToken</cite> to the upstream. Additionally, the <cite>Authorization</cite> header will be populated
with the same value.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>The OAuth2 filter is currently under active development.</p>
</div>
<div class="section" id="example-configuration">
<h2>Example configuration<a class="headerlink" href="#example-configuration" title="Permalink to this headline">¶</a></h2>
<p>The following is an example configuring the filter.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">config</span><span class="p">:</span>
  <span class="nt">token_endpoint</span><span class="p">:</span>
    <span class="nt">cluster</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">oauth</span>
    <span class="nt">uri</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">oauth.com/token</span>
    <span class="nt">timeout</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3s</span>
  <span class="nt">authorization_endpoint</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">https://oauth.com/oauth/authorize/</span>
  <span class="nt">redirect_uri</span><span class="p">:</span> <span class="s">&quot;%REQ(:x-forwarded-proto)%://%REQ(:authority)%/callback&quot;</span>
  <span class="nt">redirect_path_matcher</span><span class="p">:</span>
    <span class="nt">path</span><span class="p">:</span>
      <span class="nt">exact</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/callback</span>
  <span class="nt">signout_path</span><span class="p">:</span>
    <span class="nt">path</span><span class="p">:</span>
      <span class="nt">exact</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/signout</span>
  <span class="nt">credentials</span><span class="p">:</span>
    <span class="nt">client_id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">foo</span>
    <span class="nt">token_secret</span><span class="p">:</span>
      <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">token</span>
      <span class="nt">sds_config</span><span class="p">:</span>
        <span class="nt">path</span><span class="p">:</span> <span class="s">&quot;/etc/envoy/token-secret.yaml&quot;</span>
    <span class="nt">hmac_secret</span><span class="p">:</span>
      <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">hmac</span>
      <span class="nt">sds_config</span><span class="p">:</span>
        <span class="nt">path</span><span class="p">:</span> <span class="s">&quot;/etc/envoy/hmac.yaml&quot;</span>
  <span class="c1"># (Optional): defaults to &#39;user&#39; scope if not provided</span>
  <span class="nt">auth_scopes</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">user</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">openid</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">email</span>
  <span class="c1"># (Optional): set resource parameter for Authorization request</span>
  <span class="nt">resources</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">oauth2-resource</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">http://example.com</span>
</pre></div>
</div>
<p>Below is a complete code example of how we employ the filter as one of
<a class="reference internal" href="../../../api-v3/extensions/filters/network/http_connection_manager/v3/http_connection_manager.proto.html#envoy-v3-api-field-extensions-filters-network-http-connection-manager-v3-httpconnectionmanager-http-filters"><span class="std std-ref">HttpConnectionManager HTTP filters</span></a></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">static_resources</span><span class="p">:</span>
  <span class="nt">listeners</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span>
    <span class="nt">address</span><span class="p">:</span>
  <span class="nt">filter_chains</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">filters</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">envoy.filters.network.http_connection_manager</span>
      <span class="nt">typed_config</span><span class="p">:</span>
        <span class="s">&quot;@type&quot;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">type.googleapis.com/envoy.extensions.filters.network.http_connection_manager.v3.HttpConnectionManager</span>
        <span class="nt">http_filters</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">envoy.filters.http.oauth2</span>
          <span class="nt">typed_config</span><span class="p">:</span>
            <span class="s">&quot;@type&quot;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">type.googleapis.com/envoy.extensions.filters.http.oauth2.v3alpha.OAuth2</span>
            <span class="nt">config</span><span class="p">:</span>
              <span class="nt">token_endpoint</span><span class="p">:</span>
                <span class="nt">cluster</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">oauth</span>
                <span class="nt">uri</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">oauth.com/token</span>
                <span class="nt">timeout</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3s</span>
              <span class="nt">authorization_endpoint</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">https://oauth.com/oauth/authorize/</span>
              <span class="nt">redirect_uri</span><span class="p">:</span> <span class="s">&quot;%REQ(:x-forwarded-proto)%://%REQ(:authority)%/callback&quot;</span>
              <span class="nt">redirect_path_matcher</span><span class="p">:</span>
                <span class="nt">path</span><span class="p">:</span>
                  <span class="nt">exact</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/callback</span>
              <span class="nt">signout_path</span><span class="p">:</span>
                <span class="nt">path</span><span class="p">:</span>
                  <span class="nt">exact</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/signout</span>
              <span class="nt">credentials</span><span class="p">:</span>
                <span class="nt">client_id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">foo</span>
                <span class="nt">token_secret</span><span class="p">:</span>
                  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">token</span>
                  <span class="nt">sds_config</span><span class="p">:</span>
                    <span class="nt">path</span><span class="p">:</span> <span class="s">&quot;/etc/envoy/token-secret.yaml&quot;</span>
                <span class="nt">hmac_secret</span><span class="p">:</span>
                  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">hmac</span>
                  <span class="nt">sds_config</span><span class="p">:</span>
                    <span class="nt">path</span><span class="p">:</span> <span class="s">&quot;/etc/envoy/hmac.yaml&quot;</span>
              <span class="c1"># (Optional): defaults to &#39;user&#39; scope if not provided</span>
              <span class="nt">auth_scopes</span><span class="p">:</span>
              <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">user</span>
              <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">openid</span>
              <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">email</span>
              <span class="c1"># (Optional): set resource parameter for Authorization request</span>
              <span class="nt">resources</span><span class="p">:</span>
              <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">oauth2-resource</span>
              <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">http://example.com</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">envoy.router</span>
        <span class="nt">tracing</span><span class="p">:</span> <span class="p p-Indicator">{}</span>
        <span class="nt">codec_type</span><span class="p">:</span> <span class="s">&quot;AUTO&quot;</span>
        <span class="nt">stat_prefix</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ingress_http</span>
        <span class="nt">route_config</span><span class="p">:</span>
          <span class="nt">virtual_hosts</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">service</span>
            <span class="nt">domains</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;*&quot;</span><span class="p p-Indicator">]</span>
            <span class="nt">routes</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="nt">match</span><span class="p">:</span>
                <span class="nt">prefix</span><span class="p">:</span> <span class="s">&quot;/&quot;</span>
              <span class="nt">route</span><span class="p">:</span>
                <span class="nt">cluster</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">service</span>
                <span class="nt">timeout</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5s</span>

<span class="nt">clusters</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">service</span>
  <span class="nt">connect_timeout</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5s</span>
  <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">STATIC</span>
  <span class="nt">lb_policy</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ROUND_ROBIN</span>
  <span class="nt">load_assignment</span><span class="p">:</span>
    <span class="nt">cluster_name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">service</span>
    <span class="nt">endpoints</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">lb_endpoints</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">endpoint</span><span class="p">:</span>
          <span class="nt">address</span><span class="p">:</span>
            <span class="nt">socket_address</span><span class="p">:</span>
              <span class="nt">address</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">127.0.0.1</span>
              <span class="nt">port_value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">8080</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">oauth</span>
  <span class="nt">connect_timeout</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5s</span>
  <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">LOGICAL_DNS</span>
  <span class="nt">lb_policy</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ROUND_ROBIN</span>
  <span class="nt">load_assignment</span><span class="p">:</span>
    <span class="nt">cluster_name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">oauth</span>
    <span class="nt">endpoints</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">lb_endpoints</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">endpoint</span><span class="p">:</span>
          <span class="nt">address</span><span class="p">:</span>
            <span class="nt">socket_address</span><span class="p">:</span>
              <span class="nt">address</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">auth.example.com</span>
              <span class="nt">port_value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">443</span>
  <span class="nt">tls_context</span><span class="p">:</span>
    <span class="nt">sni</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">auth.example.com</span>
</pre></div>
</div>
<p>Finally, the following code block illustrates sample contents inside a yaml file containing both credential secrets.
Both the <a class="reference internal" href="../../../api-v3/extensions/filters/http/oauth2/v3alpha/oauth.proto.html#envoy-v3-api-field-extensions-filters-http-oauth2-v3alpha-oauth2credentials-token-secret"><span class="std std-ref">token_secret</span></a>
and the <a class="reference internal" href="../../../api-v3/extensions/filters/http/oauth2/v3alpha/oauth.proto.html#envoy-v3-api-field-extensions-filters-http-oauth2-v3alpha-oauth2credentials-hmac-secret"><span class="std std-ref">hmac_secret</span></a>
can be defined in one shared file.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">static_resources</span><span class="p">:</span>
  <span class="nt">secrets</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">token</span>
    <span class="nt">generic_secret</span><span class="p">:</span>
      <span class="nt">secret</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;Your token secret here&gt;</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">hmac</span>
    <span class="nt">generic_secret</span><span class="p">:</span>
      <span class="nt">secret</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;Your hmac secret here&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="notes">
<h2>Notes<a class="headerlink" href="#notes" title="Permalink to this headline">¶</a></h2>
<p>When enabled, the OAuth filter does not protect against Cross-Site-Request-Forgery attacks on domains with
cached authentication (in the form of cookies).
It is recommended to pair this filter with the <a class="reference internal" href="../../../api-v3/extensions/filters/http/csrf/v3/csrf.proto.html#envoy-v3-api-msg-extensions-filters-http-csrf-v3-csrfpolicy"><span class="std std-ref">CSRF Filter</span></a>
to prevent malicious social engineering.</p>
<p>The service must be served over HTTPS for this filter to work properly, as the cookies use <cite>;secure</cite>. Without https, your
<a class="reference internal" href="../../../api-v3/extensions/filters/http/oauth2/v3alpha/oauth.proto.html#envoy-v3-api-field-extensions-filters-http-oauth2-v3alpha-oauth2config-authorization-endpoint"><span class="std std-ref">authorization_endpoint</span></a>
provider will likely reject the incoming request, and your access cookies will not be cached to bypass future logins.</p>
<p>The signout path will redirect the current user to ‘/’, and clear all authentication cookies related to
the HMAC validation. Consequently, the OAuth filter will then restart the full OAuth flow at the root path,
sending the user to the configured auth endpoint.</p>
<p><a class="reference internal" href="../../../api-v3/extensions/filters/http/oauth2/v3alpha/oauth.proto.html#envoy-v3-api-field-extensions-filters-http-oauth2-v3alpha-oauth2config-pass-through-matcher"><span class="std std-ref">pass_through_matcher</span></a> provides
an interface for users to provide specific header matching criteria such that, when applicable, the OAuth flow is entirely skipped.
When this occurs, the <cite>oauth_success</cite> metric is still incremented.</p>
<p>Generally, allowlisting is inadvisable from a security standpoint.</p>
</div>
<div class="section" id="statistics">
<h2>Statistics<a class="headerlink" href="#statistics" title="Permalink to this headline">¶</a></h2>
<p>The OAuth2 filter outputs statistics in the <em>&lt;stat_prefix&gt;.</em> namespace.</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>oauth_failure</p></td>
<td><p>Counter</p></td>
<td><p>Total requests that were denied.</p></td>
</tr>
<tr class="row-odd"><td><p>oauth_success</p></td>
<td><p>Counter</p></td>
<td><p>Total requests that were allowed.</p></td>
</tr>
<tr class="row-even"><td><p>oauth_unauthorization_rq</p></td>
<td><p>Counter</p></td>
<td><p>Total unauthorized requests.</p></td>
</tr>
</tbody>
</table>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="on_demand_updates_filter.html" class="btn btn-neutral float-right" title="On-demand VHDS and S/RDS Updates" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="lua_filter.html" class="btn btn-neutral float-left" title="Lua" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2016-2021, Envoy Project Authors.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>