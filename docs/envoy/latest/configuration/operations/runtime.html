

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Runtime &mdash; envoy 1.18.0-dev-502d9c documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/envoy.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/sphinx_tabs/semantic-ui-2.4.1/segment.min.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/sphinx_tabs/semantic-ui-2.4.1/menu.min.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/sphinx_tabs/semantic-ui-2.4.1/tab.min.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/sphinx_tabs/tabs.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Overload manager" href="overload_manager/overload_manager.html" />
    <link rel="prev" title="Operations" href="operations.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/envoy-logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.18.0-dev-502d9c
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../about_docs.html">About the documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../intro/intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../start/start.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../configuration.html">Configuration reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../overview/overview.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../listeners/listeners.html">Listeners</a></li>
<li class="toctree-l2"><a class="reference internal" href="../http/http.html">HTTP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../upstream/upstream.html">Upstream clusters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability/observability.html">Observability</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security/security.html">Security</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="operations.html">Operations</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Runtime</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#virtual-file-system">Virtual file system</a></li>
<li class="toctree-l4"><a class="reference internal" href="#atomicity">Atomicity</a></li>
<li class="toctree-l4"><a class="reference internal" href="#protobuf-and-json-representation">Protobuf and JSON representation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#comments">Comments</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-runtime-overrides-for-deprecated-features">Using runtime overrides for deprecated features</a></li>
<li class="toctree-l4"><a class="reference internal" href="#statistics">Statistics</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="overload_manager/overload_manager.html">Overload manager</a></li>
<li class="toctree-l3"><a class="reference internal" href="tools/router_check.html">Route table check tool</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../other_features/other_features.html">Other features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../other_protocols/other_protocols.html">Other protocols</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced/advanced.html">Advanced</a></li>
<li class="toctree-l2"><a class="reference internal" href="../best_practices/best_practices.html">Configuration best practices</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../operations/operations.html">Operations and administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../extending/extending.html">Extending Envoy for custom use cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/overview.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../version_history/version_history.html">Version history</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">envoy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../configuration.html">Configuration reference</a> &raquo;</li>
        
          <li><a href="operations.html">Operations</a> &raquo;</li>
        
      <li>Runtime</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/configuration/operations/runtime.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="runtime">
<span id="config-runtime"></span><h1>Runtime<a class="headerlink" href="#runtime" title="Permalink to this headline">¶</a></h1>
<p>The <a class="reference internal" href="../../intro/arch_overview/operations/runtime.html#arch-overview-runtime"><span class="std std-ref">runtime configuration</span></a> specifies a virtual file system tree that
contains re-loadable configuration elements. This virtual file system can be realized via a series
of local file system, static bootstrap configuration, RTDS and admin console derived overlays.</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../api-v3/config/bootstrap/v3/bootstrap.proto.html#envoy-v3-api-msg-config-bootstrap-v3-runtime"><span class="std std-ref">v3 API reference</span></a></p></li>
</ul>
<div class="section" id="virtual-file-system">
<span id="config-virtual-filesystem"></span><h2>Virtual file system<a class="headerlink" href="#virtual-file-system" title="Permalink to this headline">¶</a></h2>
<div class="section" id="layering">
<span id="config-runtime-layering"></span><h3>Layering<a class="headerlink" href="#layering" title="Permalink to this headline">¶</a></h3>
<p>The runtime can be viewed as a virtual file system consisting of multiple layers. The <a class="reference internal" href="../../api-v3/config/bootstrap/v3/bootstrap.proto.html#envoy-v3-api-msg-config-bootstrap-v3-layeredruntime"><span class="std std-ref">layered
runtime</span></a> bootstrap configuration specifies this
layering. Runtime settings in later layers override earlier layers. A typical configuration might
be:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">layers</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">static_layer_0</span>
  <span class="nt">static_layer</span><span class="p">:</span>
    <span class="nt">health_check</span><span class="p">:</span>
      <span class="nt">min_interval</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">disk_layer_0</span>
  <span class="nt">disk_layer</span><span class="p">:</span> <span class="p p-Indicator">{</span><span class="nt"> symlink_root</span><span class="p">:</span> <span class="nv">/srv/runtime/current</span><span class="p p-Indicator">,</span><span class="nt"> subdirectory</span><span class="p">:</span> <span class="nv">envoy</span> <span class="p p-Indicator">}</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">disk_layer_1</span>
  <span class="nt">disk_layer</span><span class="p">:</span> <span class="p p-Indicator">{</span><span class="nt"> symlink_root</span><span class="p">:</span> <span class="nv">/srv/runtime/current</span><span class="p p-Indicator">,</span><span class="nt"> subdirectory</span><span class="p">:</span> <span class="nv">envoy_override</span><span class="p p-Indicator">,</span><span class="nt"> append_service_cluster</span><span class="p">:</span> <span class="nv">true</span> <span class="p p-Indicator">}</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">admin_layer_0</span>
  <span class="nt">admin_layer</span><span class="p">:</span> <span class="p p-Indicator">{}</span>
</pre></div>
</div>
<p>In the deprecated <a class="reference internal" href="../../api-v3/config/bootstrap/v3/bootstrap.proto.html#envoy-v3-api-msg-config-bootstrap-v3-runtime"><span class="std std-ref">runtime</span></a> bootstrap
configuration, the layering was implicit and fixed:</p>
<ol class="arabic simple">
<li><p><a class="reference internal" href="#config-runtime-bootstrap"><span class="std std-ref">Static bootstrap configuration</span></a></p></li>
<li><p><a class="reference internal" href="#config-runtime-local-disk"><span class="std std-ref">Local disk file system</span></a></p></li>
<li><p><a class="reference internal" href="#config-runtime-local-disk"><span class="std std-ref">Local disk file system *override_subdirectory*</span></a></p></li>
<li><p><a class="reference internal" href="#config-runtime-admin"><span class="std std-ref">Admin console overrides</span></a></p></li>
</ol>
<p>with values in higher layers overriding corresponding values in lower layers.</p>
</div>
<div class="section" id="file-system-layout">
<span id="config-runtime-file-system"></span><h3>File system layout<a class="headerlink" href="#file-system-layout" title="Permalink to this headline">¶</a></h3>
<p>Various sections of the configuration guide describe the runtime settings that are available.
For example, <a class="reference internal" href="../upstream/cluster_manager/cluster_runtime.html#config-cluster-manager-cluster-runtime"><span class="std std-ref">here</span></a> are the runtime settings for
upstream clusters.</p>
<p>Each ‘.’ in a runtime key indicates a new directory in the hierarchy,
The terminal portion of a path is the file. The contents of the file constitute the runtime value.
When reading numeric values from a file, spaces and new lines will be ignored.</p>
<p><em>numerator</em> or <em>denominator</em> are reserved keywords and may not appear in any directory.</p>
</div>
<div class="section" id="static-bootstrap">
<span id="config-runtime-bootstrap"></span><h3>Static bootstrap<a class="headerlink" href="#static-bootstrap" title="Permalink to this headline">¶</a></h3>
<p>A static base runtime may be specified in the <a class="reference internal" href="../../api-v3/config/bootstrap/v3/bootstrap.proto.html#envoy-v3-api-field-config-bootstrap-v3-runtime-base"><span class="std std-ref">bootstrap configuration</span></a> via a <a class="reference internal" href="#config-runtime-proto-json"><span class="std std-ref">protobuf JSON representation</span></a>.</p>
</div>
<div class="section" id="local-disk-file-system">
<span id="config-runtime-local-disk"></span><h3>Local disk file system<a class="headerlink" href="#local-disk-file-system" title="Permalink to this headline">¶</a></h3>
<p>When the <a class="reference internal" href="#config-runtime-file-system"><span class="std std-ref">runtime virtual file system</span></a> is realized on a local
disk, it is rooted at <em>symlink_root</em> +
<em>subdirectory</em>. For example, the <em>health_check.min_interval</em> key would have the following full
file system path (using the symbolic link):</p>
<p><code class="docutils literal notranslate"><span class="pre">/srv/runtime/current/envoy/health_check/min_interval</span></code></p>
<div class="section" id="overrides">
<span id="config-runtime-local-disk-overrides"></span><h4>Overrides<a class="headerlink" href="#overrides" title="Permalink to this headline">¶</a></h4>
<p>An arbitrary number of disk file system layers can be overlaid in the <a class="reference internal" href="../../api-v3/config/bootstrap/v3/bootstrap.proto.html#envoy-v3-api-msg-config-bootstrap-v3-layeredruntime"><span class="std std-ref">layered
runtime</span></a> bootstrap configuration.</p>
<p>In the deprecated <a class="reference internal" href="../../api-v3/config/bootstrap/v3/bootstrap.proto.html#envoy-v3-api-msg-config-bootstrap-v3-runtime"><span class="std std-ref">runtime</span></a> bootstrap configuration,
there was a distinguished file system override. Assume that the folder <code class="docutils literal notranslate"><span class="pre">/srv/runtime/v1</span></code> points to
the actual file system path where global runtime configurations are stored. The following would be a
typical configuration setting for runtime:</p>
<ul class="simple">
<li><p><em>symlink_root</em>: <code class="docutils literal notranslate"><span class="pre">/srv/runtime/current</span></code></p></li>
<li><p><em>subdirectory</em>: <code class="docutils literal notranslate"><span class="pre">envoy</span></code></p></li>
<li><p><em>override_subdirectory</em>: <code class="docutils literal notranslate"><span class="pre">envoy_override</span></code></p></li>
</ul>
<p>Where <code class="docutils literal notranslate"><span class="pre">/srv/runtime/current</span></code> is a symbolic link to <code class="docutils literal notranslate"><span class="pre">/srv/runtime/v1</span></code>.</p>
</div>
<div class="section" id="cluster-specific-subdirectories">
<span id="config-runtime-local-disk-service-cluster-subdirs"></span><h4>Cluster-specific subdirectories<a class="headerlink" href="#cluster-specific-subdirectories" title="Permalink to this headline">¶</a></h4>
<p>In the deprecated <a class="reference internal" href="../../api-v3/config/bootstrap/v3/bootstrap.proto.html#envoy-v3-api-msg-config-bootstrap-v3-runtime"><span class="std std-ref">runtime</span></a> bootstrap configuration,
the <em>override_subdirectory</em> is used along with the <a class="reference internal" href="../../operations/cli.html#cmdoption-service-cluster"><code class="xref std std-option docutils literal notranslate"><span class="pre">--service-cluster</span></code></a> CLI option. Assume
that <a class="reference internal" href="../../operations/cli.html#cmdoption-service-cluster"><code class="xref std std-option docutils literal notranslate"><span class="pre">--service-cluster</span></code></a> has been set to <code class="docutils literal notranslate"><span class="pre">my-cluster</span></code>. Envoy will first look for the
<em>health_check.min_interval</em> key in the following full file system path:</p>
<p><code class="docutils literal notranslate"><span class="pre">/srv/runtime/current/envoy_override/my-cluster/health_check/min_interval</span></code></p>
<p>If found, the value will override any value found in the primary lookup path. This allows the user
to customize the runtime values for individual clusters on top of global defaults.</p>
<p>With the <a class="reference internal" href="../../api-v3/config/bootstrap/v3/bootstrap.proto.html#envoy-v3-api-msg-config-bootstrap-v3-layeredruntime"><span class="std std-ref">layered runtime</span></a> bootstrap
configuration, it is possible to specialize on service cluster via the <a class="reference internal" href="../../api-v3/config/bootstrap/v3/bootstrap.proto.html#envoy-v3-api-field-config-bootstrap-v3-runtimelayer-disklayer-append-service-cluster"><span class="std std-ref">append_service_cluster</span></a> option at any
disk layer.</p>
</div>
<div class="section" id="updating-runtime-values-via-symbolic-link-swap">
<span id="config-runtime-symbolic-link-swap"></span><h4>Updating runtime values via symbolic link swap<a class="headerlink" href="#updating-runtime-values-via-symbolic-link-swap" title="Permalink to this headline">¶</a></h4>
<p>There are two steps to update any runtime value. First, create a hard copy of the entire runtime
tree and update the desired runtime values. Second, atomically swap the symbolic link root from the
old tree to the new runtime tree, using the equivalent of the following command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">/srv/runtime:~$ ln -s /srv/runtime/v2 new &amp;&amp; mv -Tf new current</span>
</pre></div>
</div>
<p>It’s beyond the scope of this document how the file system data is deployed, garbage collected, etc.</p>
</div>
</div>
<div class="section" id="runtime-discovery-service-rtds">
<span id="config-runtime-rtds"></span><h3>Runtime Discovery Service (RTDS)<a class="headerlink" href="#runtime-discovery-service-rtds" title="Permalink to this headline">¶</a></h3>
<p>One or more runtime layers may be specified and delivered by specifying a <a class="reference internal" href="../../api-v3/config/bootstrap/v3/bootstrap.proto.html#envoy-v3-api-field-config-bootstrap-v3-runtimelayer-rtds-layer"><span class="std std-ref">rtds_layer</span></a>. This points the runtime layer at a
regular <a class="reference internal" href="../../api-docs/xds_protocol.html#xds-protocol"><span class="std std-ref">xDS</span></a> endpoint, subscribing to a single xDS resource for the given
layer. The resource type for these layers is a <a class="reference internal" href="../../api-v3/service/runtime/v3/rtds.proto.html#envoy-v3-api-msg-service-runtime-v3-runtime"><span class="std std-ref">Runtime message</span></a>.</p>
</div>
<div class="section" id="admin-console">
<span id="config-runtime-admin"></span><h3>Admin console<a class="headerlink" href="#admin-console" title="Permalink to this headline">¶</a></h3>
<p>Values can be viewed at the
<a class="reference internal" href="../../operations/admin.html#operations-admin-interface-runtime"><span class="std std-ref">/runtime admin endpoint</span></a>. Values can be modified and
added at the <a class="reference internal" href="../../operations/admin.html#operations-admin-interface-runtime-modify"><span class="std std-ref">/runtime_modify admin endpoint</span></a>. If
runtime is not configured, an empty provider is used which has the effect of using all defaults
built into the code, except for any values added via <cite>/runtime_modify</cite>.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Use the <a class="reference internal" href="../../operations/admin.html#operations-admin-interface-runtime-modify"><span class="std std-ref">/runtime_modify</span></a> endpoint with care.
Changes are effectively immediately. It is <strong>critical</strong> that the admin interface is <a class="reference internal" href="../../operations/admin.html#operations-admin-interface-security"><span class="std std-ref">properly
secured</span></a>.</p>
</div>
<p>At most one admin layer may be specified. If a non-empty <a class="reference internal" href="../../api-v3/config/bootstrap/v3/bootstrap.proto.html#envoy-v3-api-msg-config-bootstrap-v3-layeredruntime"><span class="std std-ref">layered runtime</span></a> bootstrap configuration is specified with an
absent admin layer, any mutating admin console actions will elicit a 503 response.</p>
</div>
</div>
<div class="section" id="atomicity">
<span id="config-runtime-atomicity"></span><h2>Atomicity<a class="headerlink" href="#atomicity" title="Permalink to this headline">¶</a></h2>
<p>The runtime will reload and a new snapshot will be generated in a variety of situations, i.e.:</p>
<ul class="simple">
<li><p>When a file move operation is detected under the symlink root or the symlink root changes.</p></li>
<li><p>When an admin console override is added or modified.</p></li>
</ul>
<p>All runtime layers are evaluated during a snapshot. Layers with errors are ignored and excluded from
the effective layers, see <a class="reference internal" href="#runtime-stats"><span class="std std-ref">num_layers</span></a>. Walking the symlink root will take a
non-zero amount of time, so if true atomicity is desired, the runtime directory should be immutable
and symlink changes should be used to orchestrate updates.</p>
<p>Disk layers with the same symlink root will only trigger a single refresh when a file movement is
detected. Disk layers with overlapping symlink root paths that are not identical may trigger
multiple reloads when a file movement is detected.</p>
</div>
<div class="section" id="protobuf-and-json-representation">
<span id="config-runtime-proto-json"></span><h2>Protobuf and JSON representation<a class="headerlink" href="#protobuf-and-json-representation" title="Permalink to this headline">¶</a></h2>
<p>The runtime <a class="reference internal" href="#config-runtime-file-system"><span class="std std-ref">file system</span></a> can be represented inside a proto3
message as a <a class="reference external" href="https://developers.google.com/protocol-buffers/docs/reference/google.protobuf#google.protobuf.Struct">google.protobuf.Struct</a>
modeling a JSON object with the following rules:</p>
<ul class="simple">
<li><p>Dot separators map to tree edges.</p></li>
<li><p>Scalar leaves (integer, strings, booleans, doubles) are represented with their respective JSON type.</p></li>
<li><p><a class="reference internal" href="../../api-v3/type/v3/percent.proto.html#envoy-v3-api-msg-type-v3-fractionalpercent"><span class="std std-ref">FractionalPercent</span></a> is represented with via its
<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto3#json">canonical JSON encoding</a>.</p></li>
</ul>
<p>An example representation of a setting for the <em>health_check.min_interval</em> key in YAML is:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">health_check</span><span class="p">:</span>
  <span class="nt">min_interval</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Integer values that are parsed from doubles are rounded down to the nearest whole number.</p>
</div>
</div>
<div class="section" id="comments">
<span id="config-runtime-comments"></span><h2>Comments<a class="headerlink" href="#comments" title="Permalink to this headline">¶</a></h2>
<p>Lines starting with <code class="docutils literal notranslate"><span class="pre">#</span></code> as the first character are treated as comments.</p>
<p>Comments can be used to provide context on an existing value. Comments are also useful in an
otherwise empty file to keep a placeholder for deployment in a time of need.</p>
</div>
<div class="section" id="using-runtime-overrides-for-deprecated-features">
<span id="config-runtime-deprecation"></span><h2>Using runtime overrides for deprecated features<a class="headerlink" href="#using-runtime-overrides-for-deprecated-features" title="Permalink to this headline">¶</a></h2>
<p>The Envoy runtime is also a part of the Envoy feature deprecation process.</p>
<p>As described in the Envoy <a class="reference external" href="https://github.com/envoyproxy/envoy/blob/502d9cb5c7d8d9061337aec6e94c07afcc514e00/CONTRIBUTING.md#breaking-change-policy">breaking change policy</a>,
feature deprecation in Envoy is in 3 phases: warn-by-default, fail-by-default, and code removal.</p>
<p>In the first phase, Envoy logs a warning to the warning log that the feature is deprecated and
increments the <a class="reference internal" href="#runtime-stats"><span class="std std-ref">deprecated_feature_use</span></a> runtime stat.
Users are encouraged to go to <a class="reference internal" href="../../version_history/version_history.html#deprecated"><span class="std std-ref">deprecated</span></a> to see how to
migrate to the new code path and make sure it is suitable for their use case.</p>
<p>In the second phase the field will be tagged as disallowed_by_default
and use of that configuration field will cause the config to be rejected by default.
This disallowed mode can be overridden in runtime configuration by setting
envoy.deprecated_features:full_fieldname or envoy.deprecated_features:full_enum_value
to true. For example, for a deprecated field
<code class="docutils literal notranslate"><span class="pre">Foo.Bar.Eep</span></code> set <code class="docutils literal notranslate"><span class="pre">envoy.deprecated_features:Foo.bar.Eep</span></code> to
<code class="docutils literal notranslate"><span class="pre">true</span></code>. There is a production example using static runtime to allow both fail-by-default fields here:
<a class="reference external" href="https://github.com/envoyproxy/envoy/blob/502d9cb5c7d8d9061337aec6e94c07afcc514e00/configs/using_deprecated_config.yaml">configs/using_deprecated_config.yaml</a>. The disallowed mode can also be overridden in runtime
configuration by setting <code class="docutils literal notranslate"><span class="pre">envoy.features.enable_all_deprecated_feature</span></code> to <code class="docutils literal notranslate"><span class="pre">true</span></code>, which allows
the use of all deprecated fields.
Use of these overrides is <strong>strongly discouraged</strong> so please use with caution and switch to the new fields
as soon as possible. Fatal-by-default configuration indicates that the removal of the old code paths is
imminent. It is far better for both Envoy users and for Envoy contributors if any bugs or feature gaps
with the new code paths are flushed out ahead of time, rather than after the code is removed!</p>
<div class="admonition attention" id="runtime-stats">
<p class="admonition-title">Attention</p>
<p>Versions of Envoy prior to 1.14.1 cannot parse runtime booleans from integer values and require
an explicit “true” or “false”. Mistakenly placing an integer such as “0” to represent “false”
will lead to usage of the default value. This is especially important to keep in mind for case of
runtime overrides for <a class="reference internal" href="../../version_history/version_history.html#deprecated"><span class="std std-ref">deprecated features</span></a>, as it will can potentially result
in unexpected Envoy behaviors.</p>
</div>
</div>
<div class="section" id="statistics">
<h2>Statistics<a class="headerlink" href="#statistics" title="Permalink to this headline">¶</a></h2>
<p>The file system runtime provider emits some statistics in the <em>runtime.</em> namespace.</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>admin_overrides_active</p></td>
<td><p>Gauge</p></td>
<td><p>1 if any admin overrides are active otherwise 0</p></td>
</tr>
<tr class="row-odd"><td><p>deprecated_feature_use</p></td>
<td><p>Counter</p></td>
<td><p>Total number of times deprecated features were used. Detailed information about the feature used will be logged to warning logs in the form “Using deprecated option ‘X’ from file Y”.</p></td>
</tr>
<tr class="row-even"><td><p>deprecated_feature_seen_since_process_start</p></td>
<td><p>Gauge</p></td>
<td><p>Number of times deprecated features were used. This is not carried over during hot restarts.</p></td>
</tr>
<tr class="row-odd"><td><p>load_error</p></td>
<td><p>Counter</p></td>
<td><p>Total number of load attempts that resulted in an error in any layer</p></td>
</tr>
<tr class="row-even"><td><p>load_success</p></td>
<td><p>Counter</p></td>
<td><p>Total number of load attempts that were successful at all layers</p></td>
</tr>
<tr class="row-odd"><td><p>num_keys</p></td>
<td><p>Gauge</p></td>
<td><p>Number of keys currently loaded</p></td>
</tr>
<tr class="row-even"><td><p>num_layers</p></td>
<td><p>Gauge</p></td>
<td><p>Number of layers currently active (without loading errors)</p></td>
</tr>
<tr class="row-odd"><td><p>override_dir_exists</p></td>
<td><p>Counter</p></td>
<td><p>Total number of loads that did use an override directory</p></td>
</tr>
<tr class="row-even"><td><p>override_dir_not_exists</p></td>
<td><p>Counter</p></td>
<td><p>Total number of loads that did not use an override directory</p></td>
</tr>
</tbody>
</table>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="overload_manager/overload_manager.html" class="btn btn-neutral float-right" title="Overload manager" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="operations.html" class="btn btn-neutral float-left" title="Operations" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2016-2021, Envoy Project Authors

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>