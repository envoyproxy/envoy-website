

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>External Processing Filter &mdash; envoy 1.18.0-dev-56eb1e documentation</title>
  

  
  <link rel="stylesheet" href="../../../../../../_static/css/envoy.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../../_static/sphinx_tabs/semantic-ui-2.4.1/segment.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../../_static/sphinx_tabs/semantic-ui-2.4.1/menu.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../../_static/sphinx_tabs/semantic-ui-2.4.1/tab.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../../_static/sphinx_tabs/tabs.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../../_static/copybutton.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../../../../_static/favicon.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../../../" src="../../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../../_static/jquery.js"></script>
        <script src="../../../../../../_static/underscore.js"></script>
        <script src="../../../../../../_static/doctools.js"></script>
        <script src="../../../../../../_static/language_data.js"></script>
        <script src="../../../../../../_static/clipboard.min.js"></script>
        <script src="../../../../../../_static/copybutton.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../search.html" />
    <link rel="next" title="External Processing Filter" href="processing_mode.proto.html" />
    <link rel="prev" title="Admission Control" href="../../admission_control/v3alpha/admission_control.proto.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../../../index.html">
          

          
            
            <img src="../../../../../../_static/envoy-logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.18.0-dev-56eb1e
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../about_docs.html">About the documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../intro/intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../start/start.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../configuration/configuration.html">Configuration reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../operations/operations.html">Operations and administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../extending/extending.html">Extending Envoy for custom use cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../api/api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../faq/overview.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../version_history/version_history.html">Version history</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../../index.html">envoy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../../../../../configuration/configuration.html">Configuration reference</a> &raquo;</li>
        
          <li><a href="../../../../../../configuration/http/http.html">HTTP</a> &raquo;</li>
        
          <li><a href="../../../../../../configuration/http/http_filters/http_filters.html">HTTP filters</a> &raquo;</li>
        
      <li>External Processing Filter</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../../../../_sources/api-v3/extensions/filters/http/ext_proc/v3alpha/ext_proc.proto.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="external-processing-filter">
<span id="envoy-v3-api-file-envoy-extensions-filters-http-ext-proc-v3alpha-ext-proc-proto"></span><h1>External Processing Filter<a class="headerlink" href="#external-processing-filter" title="Permalink to this headline">¶</a></h1>
<p id="extension-envoy-filters-http-ext-proc">This extension may be referenced by the qualified name <em>envoy.filters.http.ext_proc</em></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This extension is functional but has not had substantial production burn time, use only with this caveat.</p>
<p>This extension has an unknown security posture and should only be used in deployments where both the downstream and upstream are trusted.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>This extension extends and can be used with the following extension categories:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../../network/http_connection_manager/v3/http_connection_manager.proto.html#extension-category-envoy-filters-http"><span class="std std-ref">envoy.filters.http</span></a></p></li>
</ul>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This API is work-in-progress and is subject to breaking changes.</p>
</div>
<p>External Processing Filter</p>
<p>The External Processing filter allows an external service to act on HTTP traffic in a flexible way.</p>
<p><strong>Current Implementation Status:</strong>
At this time, the filter will send the “request_headers” and “response_headers” messages
to the server when the filter is invoked, and apply any header mutations returned by the
server, and respond to “immediate_response” messages. No other parts of the protocol are implemented yet.</p>
<p>As designed, the filter supports up to six different processing steps, which are in the
process of being implemented:
* Request headers: IMPLEMENTED
* Request body: NOT IMPLEMENTED
* Request trailers: NOT IMPLEMENTED
* Response headers: IMPLEMENTED
* Response body: NOT IMPLEMENTED
* Response trailers: NOT IMPLEMENTED</p>
<p>The filter communicates with an external gRPC service that can use it to do a variety of things
with the request and response:</p>
<ul class="simple">
<li><p>Access and modify the HTTP headers on the request, response, or both</p></li>
<li><p>Access and modify the HTTP request and response bodies</p></li>
<li><p>Access and modify the dynamic stream metadata</p></li>
<li><p>Immediately send an HTTP response downstream and terminate other processing</p></li>
</ul>
<p>The filter communicates with the server using a gRPC bidirectional stream. After the initial
request, the external server is in control over what additional data is sent to it
and how it should be processed.</p>
<p>By implementing the protocol specified by the stream, the external server can choose:</p>
<ul class="simple">
<li><p>Whether it receives the response message at all</p></li>
<li><p>Whether it receives the message body at all, in separate chunks, or as a single buffer</p></li>
<li><p>Whether subsequent HTTP requests are transmitted synchronously or whether they are
sent asynchronously.</p></li>
</ul>
<p>All of this together allows a server to process the filter traffic in fairly
sophisticated ways. For example:</p>
<ul class="simple">
<li><p>A server may choose to examine all or part of the HTTP message bodies depending
on the content of the headers.</p></li>
<li><p>A server may choose to immediately reject some messages based on their HTTP
headers (or other dynamic metadata) and more carefully examine others</p></li>
<li><p>A server may asynchronously monitor traffic coming through the filter by inspecting
headers, bodies, or both, and then decide to switch to a synchronous processing
mode, either permanently or temporarily.</p></li>
</ul>
<p>The protocol itself is based on a bidirectional gRPC stream. Envoy will send the
server
<a class="reference internal" href="../../../../../service/ext_proc/v3alpha/external_processor.proto.html#envoy-v3-api-msg-service-ext-proc-v3alpha-processingrequest"><span class="std std-ref">ProcessingRequest</span></a>
messages, and the server must reply with
<a class="reference internal" href="../../../../../service/ext_proc/v3alpha/external_processor.proto.html#envoy-v3-api-msg-service-ext-proc-v3alpha-processingresponse"><span class="std std-ref">ProcessingResponse</span></a>.</p>
<div class="section" id="extensions-filters-http-ext-proc-v3alpha-externalprocessor">
<span id="envoy-v3-api-msg-extensions-filters-http-ext-proc-v3alpha-externalprocessor"></span><h2>extensions.filters.http.ext_proc.v3alpha.ExternalProcessor<a class="headerlink" href="#extensions-filters-http-ext-proc-v3alpha-externalprocessor" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/envoyproxy/envoy/blob/56eb1e2f5a954994b7e3df2578d91e943e10c5ea/api/envoy/extensions/filters/http/ext_proc/v3alpha/ext_proc.proto#L75">[extensions.filters.http.ext_proc.v3alpha.ExternalProcessor proto]</a></p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;grpc_service&quot;</span><span class="p">:</span> <span class="s2">&quot;{...}&quot;</span><span class="p">,</span>
  <span class="nt">&quot;failure_mode_allow&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="nt">&quot;processing_mode&quot;</span><span class="p">:</span> <span class="s2">&quot;{...}&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-http-ext-proc-v3alpha-externalprocessor-grpc-service">
<dt>grpc_service</dt><dd><p>(<a class="reference internal" href="../../../../../config/core/v3/grpc_service.proto.html#envoy-v3-api-msg-config-core-v3-grpcservice"><span class="std std-ref">config.core.v3.GrpcService</span></a>) Configuration for the gRPC service that the filter will communicate with.
The filter supports both the “Envoy” and “Google” gRPC clients.</p>
</dd>
</dl>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-http-ext-proc-v3alpha-externalprocessor-failure-mode-allow">
<dt>failure_mode_allow</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto#scalar">bool</a>) By default, if the gRPC stream cannot be established, or if it is closed
prematurely with an error, the filter will fail. Specifically, if the
response headers have not yet been delivered, then it will return a 500
error downstream. If they have been delivered, then instead the HTTP stream to the
downstream client will be reset.
With this parameter set to true, however, then if the gRPC stream is prematurely closed
or could not be opened, processing continues without error.</p>
</dd>
</dl>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-http-ext-proc-v3alpha-externalprocessor-processing-mode">
<dt>processing_mode</dt><dd><p>(<a class="reference internal" href="processing_mode.proto.html#envoy-v3-api-msg-extensions-filters-http-ext-proc-v3alpha-processingmode"><span class="std std-ref">extensions.filters.http.ext_proc.v3alpha.ProcessingMode</span></a>) Specifies default options for how HTTP headers, trailers, and bodies are
sent. See ProcessingMode for details.</p>
</dd>
</dl>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="processing_mode.proto.html" class="btn btn-neutral float-right" title="External Processing Filter" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../../admission_control/v3alpha/admission_control.proto.html" class="btn btn-neutral float-left" title="Admission Control" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2016-2021, Envoy Project Authors

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>